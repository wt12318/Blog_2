

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/DNA.png">
  <link rel="icon" href="/img/DNA.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wutao">
  <meta name="keywords" content="">
  
    <meta name="description" content="GenomicDataCommons R 包学习，并使用该包计算 TCGA 样本的测序深度">
<meta property="og:type" content="article">
<meta property="og:title" content="使用R包GenomicDataCommons下载和处理TCGA数据">
<meta property="og:url" content="http://example.com/2022/01/07/GenomicDataCommons/index.html">
<meta property="og:site_name" content="wutao&#39;s blog">
<meta property="og:description" content="GenomicDataCommons R 包学习，并使用该包计算 TCGA 样本的测序深度">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/GenomicDataCommons.png">
<meta property="article:published_time" content="2022-01-07T02:00:00.000Z">
<meta property="article:modified_time" content="2022-01-08T08:05:24.000Z">
<meta property="article:author" content="Wu Tao">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/GenomicDataCommons.png">
  
  
  
  <title>使用R包GenomicDataCommons下载和处理TCGA数据 - wutao&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.1","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"R","line_number":true,"lib":"highlightjs","highlightjs":{"style":"Stackoverflow Light","style_dark":"light"},"prismjs":{"style":"default","preprocess":true}},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"A5lchRnum84Yumu5pVOSoVN8-MdYXbMMI","app_key":"runF3Mxw7648v64CISxiqMs8","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wutao&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="使用R包GenomicDataCommons下载和处理TCGA数据"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        wutao
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-01-07 10:00" pubdate>
          2022年1月7日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          51k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          422 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">使用R包GenomicDataCommons下载和处理TCGA数据</h1>
            
            <div class="markdown-body">
              
              <p>GenomicDataCommons R 包学习，并使用该包计算 TCGA 样本的测序深度</p>
<span id="more"></span>

<p>GDC (Genomic Data Commons) 是美国国家癌症研究所建立的在癌症精准医疗数据方面的数据共享平台，目前已经包含几个大型的癌症基因组数据集，比如 TCGA 和 TARGET。GDC 的数据模型非常复杂，可以用下图来简单展示：</p>
<p><img src="https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/%E4%B8%8B%E8%BD%BD.png" srcset="/img/loading.gif" lazyload></p>
<p>节点表示实体，比如项目，样本，诊断，文件等，实体之间的关系用边来表示，节点和边都有相应的属性。</p>
<h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><p>这一部分展示一些基础功能</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装和一般的 <code>Bioconductor</code> 包一样：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-keyword">if</span> <span class="hljs-punctuation">(</span><span class="hljs-operator">!</span>require<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;BiocManager&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>    install.packages<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;BiocManager&quot;</span><span class="hljs-punctuation">)</span><br>BiocManager<span class="hljs-operator">::</span>install<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;GenomicDataCommons&#x27;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">library<span class="hljs-punctuation">(</span>GenomicDataCommons<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure>

<h2 id="检查连接和状态"><a href="#检查连接和状态" class="headerlink" title="检查连接和状态"></a>检查连接和状态</h2><p><code>GenomicDataCommons</code> 包需要网络连接，并且在使用时需要 NCI 的 GDC API 处于可操作和非维护状态，使用 <code>status</code> 来检查连接和状态：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs r">GenomicDataCommons<span class="hljs-operator">::</span>status<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">$</span>commit<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;b49b90e1318040f447906940f3dff145809d9ea0&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">$</span>data_release<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Data Release 31.0 - October 29, 2021&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">$</span>status<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;OK&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">$</span>tag<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;3.0.0&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">$</span>version<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>如果我们需要在脚本或者开发的包中判断连接是否正常，可以使用 <code>stopifnot</code> 函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">stopifnot<span class="hljs-punctuation">(</span>GenomicDataCommons<span class="hljs-operator">::</span>status<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>status<span class="hljs-operator">==</span><span class="hljs-string">&quot;OK&quot;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure>

<h2 id="寻找数据"><a href="#寻找数据" class="headerlink" title="寻找数据"></a>寻找数据</h2><p>在下载数据之前，我们需要先制作原始数据的 <code>manifest</code> 文件，这个文件中有数据的 UUID ，可以被 GDC 的 API 用来定位下载的文件。比如下面的代码获取了卵巢癌 RNA-seq数据的原始 counts：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs r">ge_manifest <span class="hljs-operator">=</span> files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>    filter<span class="hljs-punctuation">(</span> cases.project.project_id <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;TCGA-OV&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    filter<span class="hljs-punctuation">(</span> type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;gene_expression&#x27;</span> <span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>    filter<span class="hljs-punctuation">(</span> analysis.workflow_type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;HTSeq - Counts&#x27;</span><span class="hljs-punctuation">)</span>  <span class="hljs-operator">%&gt;%</span><br>    manifest<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">379</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br>head<span class="hljs-punctuation">(</span>ge_manifest<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># A tibble: 6 × 5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   id                                   filename                                             md5                      size state <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                                <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                                                <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                   <span class="hljs-operator">&lt;</span>dbl<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-number">451</span>c9c6d<span class="hljs-operator">-</span>f062<span class="hljs-operator">-</span><span class="hljs-number">4</span>ca2<span class="hljs-operator">-</span><span class="hljs-number">8459</span><span class="hljs-operator">-</span>efed929bd305 <span class="hljs-number">9</span>c6f2d76<span class="hljs-operator">-</span><span class="hljs-number">7701</span><span class="hljs-operator">-</span><span class="hljs-number">434</span>e<span class="hljs-operator">-</span>a876<span class="hljs-operator">-</span>c04ab14cccea.htseq.counts.gz d296b0cb99d14b4b91383… <span class="hljs-number">263970</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span> <span class="hljs-number">5</span>bc23348<span class="hljs-operator">-</span><span class="hljs-number">57</span>f9<span class="hljs-operator">-</span><span class="hljs-number">4929</span><span class="hljs-operator">-</span>a90b<span class="hljs-operator">-</span>a557696ca955 af6e5654<span class="hljs-operator">-</span>e755<span class="hljs-operator">-</span><span class="hljs-number">4</span>c15<span class="hljs-operator">-</span>b3e5<span class="hljs-operator">-</span><span class="hljs-number">807</span>da2642e25.htseq.counts.gz <span class="hljs-number">615e3868</span>d8943e94859a2… <span class="hljs-number">253867</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> <span class="hljs-number">7</span>c8ea118<span class="hljs-operator">-</span>fbce<span class="hljs-operator">-</span><span class="hljs-number">4</span>dc9<span class="hljs-operator">-</span><span class="hljs-number">803</span>d<span class="hljs-operator">-</span><span class="hljs-number">1</span>b6e30d06704 d73c0f69<span class="hljs-operator">-</span>ab9b<span class="hljs-operator">-</span><span class="hljs-number">4408</span><span class="hljs-operator">-</span>bf89<span class="hljs-operator">-</span>aa34bf829351.htseq.counts.gz ef4a8c5d45c6de49b590b… <span class="hljs-number">263239</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span> <span class="hljs-number">4</span>b83b0f5<span class="hljs-operator">-</span><span class="hljs-number">4</span>fc7<span class="hljs-operator">-</span><span class="hljs-number">4</span>a3a<span class="hljs-operator">-</span>a090<span class="hljs-operator">-</span><span class="hljs-number">3</span>ce497fb1af4 c9689d9f<span class="hljs-operator">-</span><span class="hljs-number">6138</span><span class="hljs-operator">-</span><span class="hljs-number">42</span>a8<span class="hljs-operator">-</span>a58e<span class="hljs-operator">-</span><span class="hljs-number">1</span>b44dc4b193f.htseq.counts.gz f1ffd9f86b0f6c97cbb66… <span class="hljs-number">257423</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-number">749e9</span>e26<span class="hljs-operator">-</span>eb75<span class="hljs-operator">-</span><span class="hljs-number">4681</span><span class="hljs-operator">-</span>b039<span class="hljs-operator">-</span><span class="hljs-number">6966e911</span>ae7a <span class="hljs-number">43622957</span><span class="hljs-operator">-</span><span class="hljs-number">7</span>bed<span class="hljs-operator">-</span><span class="hljs-number">4</span>d24<span class="hljs-operator">-</span>a31e<span class="hljs-operator">-</span><span class="hljs-number">5</span>fadf41216e1.htseq.counts.gz <span class="hljs-number">50e84291</span>a89a72fe3d43e… <span class="hljs-number">255649</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span> a2d8e28d<span class="hljs-operator">-</span><span class="hljs-number">0371</span><span class="hljs-operator">-</span><span class="hljs-number">4421</span><span class="hljs-operator">-</span><span class="hljs-number">8</span>ca4<span class="hljs-operator">-</span><span class="hljs-number">4629</span>a8cc7b72 <span class="hljs-number">9</span>a420e2d<span class="hljs-operator">-</span><span class="hljs-number">15</span>c8<span class="hljs-operator">-</span><span class="hljs-number">41</span>f3<span class="hljs-operator">-</span><span class="hljs-number">859</span>f<span class="hljs-operator">-</span><span class="hljs-number">25872765</span>f75e.htseq.counts.gz <span class="hljs-number">3e2</span>e347efa85410ecbd8c… <span class="hljs-number">253306</span> relea…<br>nrow<span class="hljs-punctuation">(</span>ge_manifest<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">379</span><br></code></pre></td></tr></table></figure>

<h2 id="下载数据"><a href="#下载数据" class="headerlink" title="下载数据"></a>下载数据</h2><p>通过上面步骤的筛选，获得了 379 个样本的基因表达数据的 UUID，我们可以通过这些 UUID 来下载相应的基因表达数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-comment">##演示只下载了前20个文件，已经指定了 cache dir</span><br>fnames <span class="hljs-operator">=</span> lapply<span class="hljs-punctuation">(</span>ge_manifest<span class="hljs-operator">$</span>id<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">20</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>gdcdata<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br></code></pre></td></tr></table></figure>

<p>下载需要用到的函数是 <code>gdcdata</code>，该函数接受文件的 UUID 作为输入，返回下载的文件并以 <code>Filename</code> 重命名文件，需要注意的是我们最好指定<code>gdc_cache</code> 作为 下载文件的存放目录（cache），避免多次重复下载（当然默认的 cache 目录也可以）。</p>
<p>可以查看一下下载文件的结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">tree ~/.cache/GenomicDataCommons<br>&gt;&gt; [01;34m/home/data/t040201/.cache/GenomicDataCommons[00m<br>&gt;&gt; ├── [01;34m02ab2f95-023b-492e-8dc9-20b4f52f209f[00m<br>&gt;&gt; │   └── [01;31mb1d5c444-da0d-4360-bd45-31c94217adfc.FPKM-UQ.txt.gz[00m<br>&gt;&gt; ├── [01;34m0f2ef2fa-cf6e-4d03-a648-ccd9fdf8b8c5[00m<br>&gt;&gt; │   └── [01;31mb64ef80a-d41c-4f92-a3ed-e43d55abb2c2.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m1480554d-8579-4146-93ba-a7b23b8c9a5b[00m<br>&gt;&gt; │   └── [01;31ma2082ad4-279e-422f-b5a7-cb7fbeb7a6df.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m1c099182-703f-4aaf-b1d6-0f9be5094b9a[00m<br>&gt;&gt; │   └── [01;31mfea3c4d0-7b9f-4279-989e-535aaefbdfeb.FPKM.txt.gz[00m<br>&gt;&gt; ├── [01;34m3b82236e-b055-4d10-acb4-b5a5992a1261[00m<br>&gt;&gt; │   └── [01;31m6aa7225b-3d10-4b19-a472-0adeb21c26cf.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m451c9c6d-f062-4ca2-8459-efed929bd305[00m<br>&gt;&gt; │   └── [01;31m9c6f2d76-7701-434e-a876-c04ab14cccea.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m4958b9d4-59fa-49e4-a849-1b777452f6d2[00m<br>&gt;&gt; │   └── [01;31m3e00e8aa-31bc-454e-b558-7bcbad5f47ad.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m4b83b0f5-4fc7-4a3a-a090-3ce497fb1af4[00m<br>&gt;&gt; │   └── [01;31mc9689d9f-6138-42a8-a58e-1b44dc4b193f.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m581b0bcf-a7e5-44ec-818a-9193a0565095[00m<br>&gt;&gt; │   └── [01;31m347a8eeb-204f-41df-98d3-61394d2b7cd7.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m5bc23348-57f9-4929-a90b-a557696ca955[00m<br>&gt;&gt; │   └── [01;31maf6e5654-e755-4c15-b3e5-807da2642e25.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m5e57bd1d-f38d-447d-9d7c-1fa1c5a2ecaa[00m<br>&gt;&gt; │   └── [01;31mb269c35d-7f91-4c66-8bef-59906ec87745.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m717ca3c0-0b0e-4cf3-af34-15d0fbfd7f68[00m<br>&gt;&gt; │   └── [01;31mc255d022-a659-42bd-9099-6853b41b64c7.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m749e9e26-eb75-4681-b039-6966e911ae7a[00m<br>&gt;&gt; │   └── [01;31m43622957-7bed-4d24-a31e-5fadf41216e1.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m750f8926-4361-4a92-8c72-59c82baad867[00m<br>&gt;&gt; │   └── [01;31m195a13be-31a4-47ce-bc3d-6aba8451e304.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m769c5f60-fdf1-49b1-bba3-7f4a3ef1f9a8[00m<br>&gt;&gt; │   └── [01;31m9e198dfe-9fc6-48e2-ba06-90c49ddf48aa.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34m7c8ea118-fbce-4dc9-803d-1b6e30d06704[00m<br>&gt;&gt; │   └── [01;31md73c0f69-ab9b-4408-bf89-aa34bf829351.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34ma0765b46-5fbb-49d0-b8aa-682486927d0f[00m<br>&gt;&gt; │   └── [01;31m5a928267-356d-47e9-b8b2-f477eaa261fa.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34ma2d8e28d-0371-4421-8ca4-4629a8cc7b72[00m<br>&gt;&gt; │   └── [01;31m9a420e2d-15c8-41f3-859f-25872765f75e.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34mb44b0d52-562a-476a-a607-a7148d128359[00m<br>&gt;&gt; │   └── [01;31m062b6d0c-06b0-4d27-8702-32501278cd9c.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34mc44d4c5c-b855-4e82-bd90-0f4b6c0e0015[00m<br>&gt;&gt; │   └── [01;31m75303476-cdec-4ae4-aaf5-01abdc3213ab.htseq.counts.gz[00m<br>&gt;&gt; ├── [01;34mc9cd12a4-b4b3-416e-9046-9c06dd884547[00m<br>&gt;&gt; │   └── [01;31mac6e38b7-143c-491e-9892-4c28f51ddce5.htseq.counts.gz[00m<br>&gt;&gt; └── [01;34mcd32019f-e6e5-4cf9-a4b4-d38dfdfc0f0a[00m<br>&gt;&gt;     └── [01;31mfedd52be-18a8-423f-ba8a-4f9416f11ff5.htseq.counts.gz[00m<br>&gt;&gt; <br>&gt;&gt; 22 directories, 22 files<br></code></pre></td></tr></table></figure>

<p class="note note-primary">
如果下载的是 controlled-access 数据，需要提供 token
</p>

<h2 id="元数据获取"><a href="#元数据获取" class="headerlink" title="元数据获取"></a>元数据获取</h2><h3 id="临床数据"><a href="#临床数据" class="headerlink" title="临床数据"></a>临床数据</h3><p>获取临床数据是一个常见的任务，<code>gdc_clinical</code> 函数接受 <code>case_ids</code>，返回一个有个四个数据框的列表：</p>
<ul>
<li>人口学统计（demographic），包括性别，种族，年龄等</li>
<li>诊断（diagnoses），包括临床分期，生存时间，回访信息等</li>
<li>暴露（exposures），包括吸烟，饮酒记录等</li>
<li>main，包括疾病类型，诊断时间等</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs r">case_ids <span class="hljs-operator">=</span> cases<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> results<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> ids<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>clindat <span class="hljs-operator">=</span> gdc_clinical<span class="hljs-punctuation">(</span>case_ids<span class="hljs-punctuation">)</span><br><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>clindat<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;demographic&quot;</span> <span class="hljs-string">&quot;diagnoses&quot;</span>   <span class="hljs-string">&quot;exposures&quot;</span>   <span class="hljs-string">&quot;main&quot;</span><br><br>head<span class="hljs-punctuation">(</span>clindat<span class="hljs-punctuation">[[</span><span class="hljs-string">&quot;demographic&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># A tibble: 6 × 15</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   vital_status gender race    ethnicity  age_at_index submitter_id  days_to_birth created_datetime year_of_birth demographic_id <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>        <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>  <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>             <span class="hljs-operator">&lt;</span>int<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                 <span class="hljs-operator">&lt;</span>int<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>lgl<span class="hljs-operator">&gt;</span>                    <span class="hljs-operator">&lt;</span>int<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>          <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> Alive        female not re… not repor…           <span class="hljs-number">65</span> TCGA<span class="hljs-operator">-</span>A8<span class="hljs-operator">-</span>A07G…        <span class="hljs-operator">-</span><span class="hljs-number">23926</span> <span class="hljs-literal">NA</span>                        <span class="hljs-number">1944</span> <span class="hljs-number">38</span>caac77<span class="hljs-operator">-</span>d856<span class="hljs-operator">-</span>…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span> Dead         female black … not hispa…           <span class="hljs-number">49</span> TCGA<span class="hljs-operator">-</span>A2<span class="hljs-operator">-</span>A3XY…        <span class="hljs-operator">-</span><span class="hljs-number">18059</span> <span class="hljs-literal">NA</span>                        <span class="hljs-number">1961</span> ac6eba06<span class="hljs-operator">-</span><span class="hljs-number">6e54</span><span class="hljs-operator">-</span>…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> Alive        female white   not hispa…           <span class="hljs-number">56</span> TCGA<span class="hljs-operator">-</span>E2<span class="hljs-operator">-</span>A152…        <span class="hljs-operator">-</span><span class="hljs-number">20705</span> <span class="hljs-literal">NA</span>                        <span class="hljs-number">1953</span> <span class="hljs-number">680</span>b1fdd<span class="hljs-operator">-</span><span class="hljs-number">143</span><span class="hljs-built_in">c</span><span class="hljs-operator">-</span>…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span> Alive        female white   not hispa…           <span class="hljs-number">40</span> TCGA<span class="hljs-operator">-</span>E2<span class="hljs-operator">-</span>A15E…        <span class="hljs-operator">-</span><span class="hljs-number">14894</span> <span class="hljs-literal">NA</span>                        <span class="hljs-number">1969</span> <span class="hljs-number">1</span>b53b23d<span class="hljs-operator">-</span>b98c<span class="hljs-operator">-</span>…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> Alive        female white   not repor…           <span class="hljs-number">73</span> TCGA<span class="hljs-operator">-</span>AR<span class="hljs-operator">-</span>A0U0…        <span class="hljs-operator">-</span><span class="hljs-number">26993</span> <span class="hljs-literal">NA</span>                        <span class="hljs-number">1931</span> <span class="hljs-number">2</span>f82f157<span class="hljs-operator">-</span>cce2<span class="hljs-operator">-</span>…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span> Alive        female white   not repor…           <span class="hljs-number">52</span> TCGA<span class="hljs-operator">-</span>BH<span class="hljs-operator">-</span>A0E1…        <span class="hljs-operator">-</span><span class="hljs-number">19192</span> <span class="hljs-literal">NA</span>                        <span class="hljs-number">1957</span> <span class="hljs-number">7</span>c593975<span class="hljs-operator">-</span>bc80<span class="hljs-operator">-</span>…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># … with 5 more variables: updated_datetime &lt;chr&gt;, state &lt;chr&gt;, year_of_death &lt;lgl&gt;, days_to_death &lt;int&gt;, case_id &lt;chr&gt;</span><br>head<span class="hljs-punctuation">(</span>clindat<span class="hljs-punctuation">[[</span><span class="hljs-string">&quot;diagnoses&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># A tibble: 6 × 29</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   case_id synchronous_mal… ajcc_pathologic… days_to_diagnos… created_datetime last_known_dise… tissue_or_organ… days_to_last_fo…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>            <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                       <span class="hljs-operator">&lt;</span>int<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>lgl<span class="hljs-operator">&gt;</span>            <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>            <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                       <span class="hljs-operator">&lt;</span>int<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-number">8</span>cf8b6… No               Stage IIA                       <span class="hljs-number">0</span> <span class="hljs-literal">NA</span>               not reported     Breast<span class="hljs-punctuation">,</span> NOS                   <span class="hljs-number">577</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span> deba32… No               Stage IIB                       <span class="hljs-number">0</span> <span class="hljs-literal">NA</span>               not reported     Breast<span class="hljs-punctuation">,</span> NOS                  <span class="hljs-number">1064</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> a80154… No               Stage I                         <span class="hljs-number">0</span> <span class="hljs-literal">NA</span>               not reported     Breast<span class="hljs-punctuation">,</span> NOS                  <span class="hljs-number">2128</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span>a2a35… No               Stage IIA                       <span class="hljs-number">0</span> <span class="hljs-literal">NA</span>               not reported     Breast<span class="hljs-punctuation">,</span> NOS                   <span class="hljs-number">630</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> e3c336… No               Stage IIB                       <span class="hljs-number">0</span> <span class="hljs-literal">NA</span>               not reported     Breast<span class="hljs-punctuation">,</span> NOS                  <span class="hljs-number">1988</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span> <span class="hljs-number">606</span>fbc… No               Stage IIB                       <span class="hljs-number">0</span> <span class="hljs-literal">NA</span>               not reported     Breast<span class="hljs-punctuation">,</span> NOS                   <span class="hljs-number">477</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># … with 21 more variables: primary_diagnosis &lt;chr&gt;, age_at_diagnosis &lt;int&gt;, updated_datetime &lt;chr&gt;, year_of_diagnosis &lt;int&gt;,</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment">#   prior_malignancy &lt;chr&gt;, state &lt;chr&gt;, prior_treatment &lt;chr&gt;, days_to_last_known_disease_status &lt;lgl&gt;,</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment">#   ajcc_staging_system_edition &lt;chr&gt;, ajcc_pathologic_t &lt;chr&gt;, days_to_recurrence &lt;lgl&gt;, morphology &lt;chr&gt;,</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment">#   ajcc_pathologic_n &lt;chr&gt;, ajcc_pathologic_m &lt;chr&gt;, submitter_id &lt;chr&gt;, classification_of_tumor &lt;chr&gt;, diagnosis_id &lt;chr&gt;,</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment">#   icd_10_code &lt;chr&gt;, site_of_resection_or_biopsy &lt;chr&gt;, tumor_grade &lt;chr&gt;, progression_or_recurrence &lt;chr&gt;</span><br>head<span class="hljs-punctuation">(</span>clindat<span class="hljs-punctuation">[[</span><span class="hljs-string">&quot;exposures&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># A tibble: 6 × 10</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   case_id    cigarettes_per_d… updated_datetime   alcohol_history exposure_id   submitter_id years_smoked state created_datetime<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>      <span class="hljs-operator">&lt;</span>lgl<span class="hljs-operator">&gt;</span>             <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>              <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>           <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>         <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>        <span class="hljs-operator">&lt;</span>lgl<span class="hljs-operator">&gt;</span>        <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>lgl<span class="hljs-operator">&gt;</span>           <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-number">8</span>cf8b620<span class="hljs-operator">-</span>… <span class="hljs-literal">NA</span>                <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">07</span><span class="hljs-operator">-</span><span class="hljs-number">31</span>T21<span class="hljs-operator">:</span><span class="hljs-number">48</span><span class="hljs-operator">:</span>… Not Reported    a8be57c5<span class="hljs-operator">-</span><span class="hljs-number">620</span>… TCGA<span class="hljs-operator">-</span>A8<span class="hljs-operator">-</span>A07… <span class="hljs-literal">NA</span>           rele… <span class="hljs-literal">NA</span>              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span> deba32e4<span class="hljs-operator">-</span>… <span class="hljs-literal">NA</span>                <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">07</span><span class="hljs-operator">-</span><span class="hljs-number">31</span>T21<span class="hljs-operator">:</span><span class="hljs-number">29</span><span class="hljs-operator">:</span>… Not Reported    <span class="hljs-number">9</span>aa5cc63<span class="hljs-operator">-</span>cea… TCGA<span class="hljs-operator">-</span>A2<span class="hljs-operator">-</span>A3X… <span class="hljs-literal">NA</span>           rele… <span class="hljs-literal">NA</span>              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> a8015490<span class="hljs-operator">-</span>… <span class="hljs-literal">NA</span>                <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">07</span><span class="hljs-operator">-</span><span class="hljs-number">31</span>T21<span class="hljs-operator">:</span><span class="hljs-number">52</span><span class="hljs-operator">:</span>… Not Reported    <span class="hljs-number">134</span>cee43<span class="hljs-operator">-</span><span class="hljs-number">117</span>… TCGA<span class="hljs-operator">-</span>E2<span class="hljs-operator">-</span>A15… <span class="hljs-literal">NA</span>           rele… <span class="hljs-literal">NA</span>              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span>a2a3529<span class="hljs-operator">-</span>… <span class="hljs-literal">NA</span>                <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">07</span><span class="hljs-operator">-</span><span class="hljs-number">31</span>T21<span class="hljs-operator">:</span><span class="hljs-number">31</span><span class="hljs-operator">:</span>… Not Reported    fdf22b2e<span class="hljs-operator">-</span><span class="hljs-number">0</span>ba… TCGA<span class="hljs-operator">-</span>E2<span class="hljs-operator">-</span>A15… <span class="hljs-literal">NA</span>           rele… <span class="hljs-literal">NA</span>              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> e3c336f5<span class="hljs-operator">-</span>… <span class="hljs-literal">NA</span>                <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">07</span><span class="hljs-operator">-</span><span class="hljs-number">31</span>T15<span class="hljs-operator">:</span><span class="hljs-number">38</span><span class="hljs-operator">:</span>… Not Reported    <span class="hljs-number">3</span>d1c43ad<span class="hljs-operator">-</span>b1d… TCGA<span class="hljs-operator">-</span>AR<span class="hljs-operator">-</span>A0U… <span class="hljs-literal">NA</span>           rele… <span class="hljs-literal">NA</span>              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span> <span class="hljs-number">606</span>fbc6a<span class="hljs-operator">-</span>… <span class="hljs-literal">NA</span>                <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">07</span><span class="hljs-operator">-</span><span class="hljs-number">31</span>T21<span class="hljs-operator">:</span><span class="hljs-number">42</span><span class="hljs-operator">:</span>… Not Reported    <span class="hljs-number">1</span>d844394<span class="hljs-operator">-</span><span class="hljs-number">425</span>… TCGA<span class="hljs-operator">-</span>BH<span class="hljs-operator">-</span>A0E… <span class="hljs-literal">NA</span>           rele… <span class="hljs-literal">NA</span>              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># … with 1 more variable: alcohol_intensity &lt;lgl&gt;</span><br>head<span class="hljs-punctuation">(</span>clindat<span class="hljs-punctuation">[[</span><span class="hljs-string">&quot;main&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># A tibble: 6 × 8</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   id                                   disease_type  submitter_id created_datetime primary_site updated_datetime  case_id  state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                                <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>         <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>        <span class="hljs-operator">&lt;</span>lgl<span class="hljs-operator">&gt;</span>            <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>        <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>             <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>    <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-number">8</span>cf8b620<span class="hljs-operator">-</span><span class="hljs-number">7</span>ab6<span class="hljs-operator">-</span><span class="hljs-number">4</span>b6e<span class="hljs-operator">-</span><span class="hljs-number">84</span>bc<span class="hljs-operator">-</span>ff5a83f381fa Ductal and L… TCGA<span class="hljs-operator">-</span>A8<span class="hljs-operator">-</span>A07G <span class="hljs-literal">NA</span>               Breast       <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">06</span>T14<span class="hljs-operator">:</span><span class="hljs-number">14</span>… <span class="hljs-number">8</span>cf8b62… rele…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span> deba32e4<span class="hljs-operator">-</span><span class="hljs-number">0e68</span><span class="hljs-operator">-</span><span class="hljs-number">4711</span><span class="hljs-operator">-</span><span class="hljs-number">941</span>b<span class="hljs-operator">-</span><span class="hljs-number">3</span>b63bd965afb Ductal and L… TCGA<span class="hljs-operator">-</span>A2<span class="hljs-operator">-</span>A3XY <span class="hljs-literal">NA</span>               Breast       <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">06</span>T14<span class="hljs-operator">:</span><span class="hljs-number">14</span>… deba32e… rele…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> a8015490<span class="hljs-operator">-</span><span class="hljs-number">9740</span><span class="hljs-operator">-</span><span class="hljs-number">45</span>c9<span class="hljs-operator">-</span><span class="hljs-number">8</span>bd2<span class="hljs-operator">-</span>eb6d1beefc2e Ductal and L… TCGA<span class="hljs-operator">-</span>E2<span class="hljs-operator">-</span>A152 <span class="hljs-literal">NA</span>               Breast       <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">06</span>T14<span class="hljs-operator">:</span><span class="hljs-number">16</span>… a801549… rele…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span>a2a3529<span class="hljs-operator">-</span>f645<span class="hljs-operator">-</span><span class="hljs-number">4967</span><span class="hljs-operator">-</span><span class="hljs-number">9</span>a58<span class="hljs-operator">-</span><span class="hljs-number">89</span>ee20b8bb62 Ductal and L… TCGA<span class="hljs-operator">-</span>E2<span class="hljs-operator">-</span>A15E <span class="hljs-literal">NA</span>               Breast       <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">06</span>T14<span class="hljs-operator">:</span><span class="hljs-number">16</span>… <span class="hljs-number">0</span>a2a352… rele…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> e3c336f5<span class="hljs-operator">-</span>c32f<span class="hljs-operator">-</span><span class="hljs-number">4</span>c5d<span class="hljs-operator">-</span><span class="hljs-number">81</span>fb<span class="hljs-operator">-</span>e2408ae145b2 Ductal and L… TCGA<span class="hljs-operator">-</span>AR<span class="hljs-operator">-</span>A0U0 <span class="hljs-literal">NA</span>               Breast       <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">06</span>T14<span class="hljs-operator">:</span><span class="hljs-number">15</span>… e3c336f… rele…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span> <span class="hljs-number">606</span>fbc6a<span class="hljs-operator">-</span>b41b<span class="hljs-operator">-</span><span class="hljs-number">441</span>d<span class="hljs-operator">-</span><span class="hljs-number">9401</span><span class="hljs-operator">-</span><span class="hljs-number">51e54912</span>bf5e Ductal and L… TCGA<span class="hljs-operator">-</span>BH<span class="hljs-operator">-</span>A0E1 <span class="hljs-literal">NA</span>               Breast       <span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">06</span>T14<span class="hljs-operator">:</span><span class="hljs-number">15</span>… <span class="hljs-number">606</span>fbc6… rele…<br></code></pre></td></tr></table></figure>

<h3 id="广义的元数据获取"><a href="#广义的元数据获取" class="headerlink" title="广义的元数据获取"></a>广义的元数据获取</h3><p>我们可以通过 <code>GenomicDataCommons</code> 结合各种参数（比如 <code>filter</code>, <code>select</code>, <code>expand</code>等）来灵活的获取想要的元数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs r">expands <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">&quot;diagnoses&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;annotations&quot;</span><span class="hljs-punctuation">,</span><br>             <span class="hljs-string">&quot;demographic&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;exposures&quot;</span><span class="hljs-punctuation">)</span><br>clinResults <span class="hljs-operator">=</span> cases<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>    GenomicDataCommons<span class="hljs-operator">::</span>select<span class="hljs-punctuation">(</span><span class="hljs-literal">NULL</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>    GenomicDataCommons<span class="hljs-operator">::</span>expand<span class="hljs-punctuation">(</span>expands<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>    results<span class="hljs-punctuation">(</span>size<span class="hljs-operator">=</span><span class="hljs-number">50</span><span class="hljs-punctuation">)</span><br>str<span class="hljs-punctuation">(</span>clinResults<span class="hljs-punctuation">[[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>list.len<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">50</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;8cf8b620-7ab6-4b6e-84bc-ff5a83f381fa&quot;</span> <span class="hljs-string">&quot;deba32e4-0e68-4711-941b-3b63bd965afb&quot;</span> ...<br></code></pre></td></tr></table></figure>

<h1 id="基本设计"><a href="#基本设计" class="headerlink" title="基本设计"></a>基本设计</h1><p>从上面的例子中可以看出这个包的设计行为和 <code>dplyr</code> 是非常类似的，一些动词也是直接和 <code>dplyr</code> 的函数同名(filter, select 等)。简单来说，该包检索，获取元数据和文件分为三步：</p>
<ul>
<li>请求构造函数（query constructors，如上面的 <code>cases()</code>, <code>files()</code>）</li>
<li>一系列的动词用来过滤样本，选择字段，聚合并生成最终的请求对象（query object，如 <code>filter</code>, <code>select</code>等）</li>
<li>使用一系列动词基于上面得到的请求对象获取文件，返回结果（如 <code>gdcdata</code>）</li>
</ul>
<p>完成上述过程的基本函数如下：</p>
<ul>
<li>创建请求：<ul>
<li><code>projects()</code></li>
<li><code>cases()</code></li>
<li><code>files()</code></li>
<li><code>annotations()</code></li>
</ul>
</li>
<li>操作请求：<ul>
<li><code>filter()</code></li>
<li><code>facet()</code></li>
<li><code>select()</code></li>
<li><code>expand()</code></li>
</ul>
</li>
<li>GDC API 字段的内省（introspection, 即支持哪些查询，有哪些字段及字段类型等信息）：<ul>
<li><code>mapping()</code></li>
<li><code>available_fields()</code></li>
<li><code>default_fields()</code></li>
<li><code>grep_fields()</code></li>
<li><code>field_picker()</code></li>
<li><code>available_values()</code></li>
<li><code>available_expand()</code></li>
</ul>
</li>
<li>执行 API 调用，获取请求的结果：<ul>
<li><code>results()</code></li>
<li><code>count()</code></li>
<li><code>response()</code></li>
</ul>
</li>
<li>原始数据下载：<ul>
<li><code>gdcdata()</code></li>
<li><code>transfer()</code></li>
<li><code>gdc_client()</code></li>
</ul>
</li>
<li>汇总，聚合字段值（也叫 faceting）：<ul>
<li><code>aggregations()</code></li>
</ul>
</li>
<li>Control 数据的授权（token）：<ul>
<li><code>gdc_token()</code></li>
</ul>
</li>
<li>BAM 文件切片：<ul>
<li><code>slicing()</code></li>
</ul>
</li>
</ul>
<h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><p>上面那些基本函数构成了两大类操作：</p>
<ul>
<li>检索元数据和寻找数据文件</li>
<li>传输原始数据或者处理后的数据</li>
</ul>
<h2 id="检索元数据"><a href="#检索元数据" class="headerlink" title="检索元数据"></a>检索元数据</h2><h3 id="创建检索"><a href="#创建检索" class="headerlink" title="创建检索"></a>创建检索</h3><p>有四种方便的函数可以创建 <code>GDCQuery</code> 对象来获取不同类型的数据：</p>
<ul>
<li><code>project()</code></li>
<li><code>cases()</code></li>
<li><code>files()</code></li>
<li><code>annotations()</code></li>
</ul>
<p>这些对象都含有下列的一些元素：</p>
<ul>
<li>字段（fields）：需要下载的字段，如果没有指定字段，就会使用默认字段来取回数据（默认字段可以通过<code>default_fields()</code> 来查看）</li>
<li>过滤器（filters）：含有调用 <code>filter()</code> 方法后获得的结果，并用来筛选取回的数据</li>
<li>facets：当调用 <code>aggregations()</code> 时对数据汇总所需的字段名</li>
<li>存档（archive）：可以是 “default” 或者 <code>legacy</code> (legacy 是比较老的数据)</li>
<li>token：下载 control 数据的凭证，对于获取元数据可以不需要，只需在下载真正数据时提供即可</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs r">pquery <span class="hljs-operator">=</span> projects<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>str<span class="hljs-punctuation">(</span>pquery<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> List of <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> fields <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;dbgap_accession_number&quot;</span> <span class="hljs-string">&quot;disease_type&quot;</span> <span class="hljs-string">&quot;intended_release_date&quot;</span> <span class="hljs-string">&quot;name&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> filters<span class="hljs-operator">:</span> <span class="hljs-literal">NULL</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> facets <span class="hljs-operator">:</span> <span class="hljs-literal">NULL</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> legacy <span class="hljs-operator">:</span> logi <span class="hljs-literal">FALSE</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> expand <span class="hljs-operator">:</span> <span class="hljs-literal">NULL</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">-</span> <span class="hljs-built_in">attr</span><span class="hljs-punctuation">(</span><span class="hljs-operator">*</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;class&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-operator">=</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;gdc_projects&quot;</span> <span class="hljs-string">&quot;GDCQuery&quot;</span> <span class="hljs-string">&quot;list&quot;</span><br><br>default_fields<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;projects&quot;</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;dbgap_accession_number&quot;</span> <span class="hljs-string">&quot;disease_type&quot;</span>           <span class="hljs-string">&quot;intended_release_date&quot;</span>  <span class="hljs-string">&quot;name&quot;</span>                  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;primary_site&quot;</span>           <span class="hljs-string">&quot;project_autocomplete&quot;</span>   <span class="hljs-string">&quot;project_id&quot;</span>             <span class="hljs-string">&quot;releasable&quot;</span>            <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">9</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;released&quot;</span>               <span class="hljs-string">&quot;state&quot;</span><br></code></pre></td></tr></table></figure>

<p>可以看到初始状态下大部分元素是空的（NULL）</p>
<h3 id="取回结果"><a href="#取回结果" class="headerlink" title="取回结果"></a>取回结果</h3><p>当有了一个请求对象后，我们就可以从 GDC 取回结果了。可以使用 <code>count()</code> 来得到最基本的结果类型，这个函数返回满足 <code>filter</code> 标准的记录数量，由于我们目前没有定义任何的过滤条件，所以这里的 <code>count()</code> 返回的是所有的 <code>project</code> 记录（在 default 存档中）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs r">pcount <span class="hljs-operator">=</span> pquery <span class="hljs-operator">%&gt;%</span> count<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>pcount<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">70</span><br></code></pre></td></tr></table></figure>

<p><code>results()</code> 可以直接取回结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">presults <span class="hljs-operator">=</span> pquery <span class="hljs-operator">%&gt;%</span> results<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure>

<p>返回的结果从 GDC 的 Json 格式被转换成 R 里面的 List，可以使用 <code>str()</code> 来简单的查看数据结构：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs r">str<span class="hljs-punctuation">(</span>presults<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> List of <span class="hljs-number">9</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> id                    <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;TCGA-BRCA&quot;</span> <span class="hljs-string">&quot;GENIE-MSK&quot;</span> <span class="hljs-string">&quot;GENIE-VICC&quot;</span> <span class="hljs-string">&quot;GENIE-UHN&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> primary_site          <span class="hljs-operator">:</span>List of <span class="hljs-number">10</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> TCGA<span class="hljs-operator">-</span>BRCA            <span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Breast&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> GENIE<span class="hljs-operator">-</span>MSK            <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">49</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Connective, subcutaneous and other soft tissues&quot;</span> <span class="hljs-string">&quot;Kidney&quot;</span> <span class="hljs-string">&quot;Prostate gland&quot;</span> <span class="hljs-string">&quot;Other and unspecified major salivary glands&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> GENIE<span class="hljs-operator">-</span>VICC           <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">46</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Connective, subcutaneous and other soft tissues&quot;</span> <span class="hljs-string">&quot;Kidney&quot;</span> <span class="hljs-string">&quot;Prostate gland&quot;</span> <span class="hljs-string">&quot;Other and unspecified major salivary glands&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> GENIE<span class="hljs-operator">-</span>UHN            <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">42</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Connective, subcutaneous and other soft tissues&quot;</span> <span class="hljs-string">&quot;Kidney&quot;</span> <span class="hljs-string">&quot;Prostate gland&quot;</span> <span class="hljs-string">&quot;Other and unspecified major salivary glands&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CPTAC<span class="hljs-operator">-</span><span class="hljs-number">2</span>              <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Ovary&quot;</span> <span class="hljs-string">&quot;Rectum&quot;</span> <span class="hljs-string">&quot;Other and unspecified female genital organs&quot;</span> <span class="hljs-string">&quot;Breast&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CMI<span class="hljs-operator">-</span>ASC              <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Bladder&quot;</span> <span class="hljs-string">&quot;Other and ill-defined sites&quot;</span> <span class="hljs-string">&quot;Other and ill-defined digestive organs&quot;</span> <span class="hljs-string">&quot;Heart, mediastinum, and pleura&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> BEATAML1.0<span class="hljs-operator">-</span>COHORT    <span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Hematopoietic and reticuloendothelial systems&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CGCI<span class="hljs-operator">-</span>BLGSP           <span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Hematopoietic and reticuloendothelial systems&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> BEATAML1.0<span class="hljs-operator">-</span>CRENOLANIB<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Hematopoietic and reticuloendothelial systems&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CMI<span class="hljs-operator">-</span>MPC              <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Prostate gland&quot;</span> <span class="hljs-string">&quot;Lymph nodes&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> dbgap_accession_number<span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-literal">NA</span> <span class="hljs-literal">NA</span> <span class="hljs-literal">NA</span> <span class="hljs-literal">NA</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> project_id            <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;TCGA-BRCA&quot;</span> <span class="hljs-string">&quot;GENIE-MSK&quot;</span> <span class="hljs-string">&quot;GENIE-VICC&quot;</span> <span class="hljs-string">&quot;GENIE-UHN&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> disease_type          <span class="hljs-operator">:</span>List of <span class="hljs-number">10</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> TCGA<span class="hljs-operator">-</span>BRCA            <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Complex Epithelial Neoplasms&quot;</span> <span class="hljs-string">&quot;Fibroepithelial Neoplasms&quot;</span> <span class="hljs-string">&quot;Adnexal and Skin Appendage Neoplasms&quot;</span> <span class="hljs-string">&quot;Adenomas and Adenocarcinomas&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> GENIE<span class="hljs-operator">-</span>MSK            <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">49</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Miscellaneous Bone Tumors&quot;</span> <span class="hljs-string">&quot;Myeloid Leukemias&quot;</span> <span class="hljs-string">&quot;Gliomas&quot;</span> <span class="hljs-string">&quot;Lipomatous Neoplasms&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> GENIE<span class="hljs-operator">-</span>VICC           <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">43</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Leukemias, NOS&quot;</span> <span class="hljs-string">&quot;Chronic Myeloproliferative Disorders&quot;</span> <span class="hljs-string">&quot;Myeloid Leukemias&quot;</span> <span class="hljs-string">&quot;Gliomas&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> GENIE<span class="hljs-operator">-</span>UHN            <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">39</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Leukemias, NOS&quot;</span> <span class="hljs-string">&quot;Chronic Myeloproliferative Disorders&quot;</span> <span class="hljs-string">&quot;Miscellaneous Bone Tumors&quot;</span> <span class="hljs-string">&quot;Myeloid Leukemias&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CPTAC<span class="hljs-operator">-</span><span class="hljs-number">2</span>              <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Not Reported&quot;</span> <span class="hljs-string">&quot;Cystic, Mucinous and Serous Neoplasms&quot;</span> <span class="hljs-string">&quot;Adenomas and Adenocarcinomas&quot;</span> <span class="hljs-string">&quot;Ductal and Lobular Neoplasms&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CMI<span class="hljs-operator">-</span>ASC              <span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Soft Tissue Tumors and Sarcomas, NOS&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> BEATAML1.0<span class="hljs-operator">-</span>COHORT    <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Leukemias, NOS&quot;</span> <span class="hljs-string">&quot;Chronic Myeloproliferative Disorders&quot;</span> <span class="hljs-string">&quot;Myeloid Leukemias&quot;</span> <span class="hljs-string">&quot;Plasma Cell Tumors&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CGCI<span class="hljs-operator">-</span>BLGSP           <span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Mature B-Cell Lymphomas&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> BEATAML1.0<span class="hljs-operator">-</span>CRENOLANIB<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Myeloid Leukemias&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> CMI<span class="hljs-operator">-</span>MPC              <span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;Adenomas and Adenocarcinomas&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> name                  <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;Breast Invasive Carcinoma&quot;</span> <span class="hljs-string">&quot;AACR Project GENIE - Contributed by Memorial Sloan Kettering Cancer Center&quot;</span> <span class="hljs-string">&quot;AACR Project GENIE - Contributed by Vanderbilt-Ingram Cancer Center&quot;</span> <span class="hljs-string">&quot;AACR Project GENIE - Contributed by Princess Margaret Cancer Centre&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> releasable            <span class="hljs-operator">:</span> logi <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-literal">TRUE</span> <span class="hljs-literal">FALSE</span> <span class="hljs-literal">FALSE</span> <span class="hljs-literal">FALSE</span> <span class="hljs-literal">TRUE</span> <span class="hljs-literal">TRUE</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> state                 <span class="hljs-operator">:</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;open&quot;</span> <span class="hljs-string">&quot;open&quot;</span> <span class="hljs-string">&quot;open&quot;</span> <span class="hljs-string">&quot;open&quot;</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> released              <span class="hljs-operator">:</span> logi <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-literal">TRUE</span> <span class="hljs-literal">TRUE</span> <span class="hljs-literal">TRUE</span> <span class="hljs-literal">TRUE</span> <span class="hljs-literal">TRUE</span> <span class="hljs-literal">TRUE</span> ...<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">-</span> <span class="hljs-built_in">attr</span><span class="hljs-punctuation">(</span><span class="hljs-operator">*</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;row.names&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-operator">=</span> int <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">-</span> <span class="hljs-built_in">attr</span><span class="hljs-punctuation">(</span><span class="hljs-operator">*</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;class&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-operator">=</span> chr <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;GDCprojectsResults&quot;</span> <span class="hljs-string">&quot;GDCResults&quot;</span> <span class="hljs-string">&quot;list&quot;</span><br></code></pre></td></tr></table></figure>

<p>可以看到默认只返回 10 条记录，我们可以使用 <code>results()</code> 的 <code>size</code> 和 <code>from</code> 参数来改变需要返回的数量（size 表示返回的记录数，from 表示从哪个索引开始返回数据）；也有一个简便的函数 <code>results_all()</code> 返回所有的请求结果，可想而知这种方法可能会导致下载的数据非常大，花费的时间比较久，因此尽量使用 <code>counts()</code> 和<code>results()</code> 来获取数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>ids<span class="hljs-punctuation">(</span>presults<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">10</span><br><br>presults <span class="hljs-operator">=</span> pquery <span class="hljs-operator">%&gt;%</span> results_all<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>ids<span class="hljs-punctuation">(</span>presults<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">70</span><br><br><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>ids<span class="hljs-punctuation">(</span>presults<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">==</span> count<span class="hljs-punctuation">(</span>pquery<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-literal">TRUE</span><br></code></pre></td></tr></table></figure>

<p>结果是以列表的形式存储的，可以使用 <code>purrr</code>，<code>rlist</code>，<code>data.tree</code> 等 R 包来操作复杂嵌套的列表，另外也可以使用 <code>listviewer</code> 包来交互式的查看列表的结构（其实和在 Rstudio 中直接打开差别不大）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">listviewer<span class="hljs-operator">::</span>jsonedit<span class="hljs-punctuation">(</span>presults<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure>

<p><img src="https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/image-20220108121517890.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="字段和值"><a href="#字段和值" class="headerlink" title="字段和值"></a>字段和值</h3><p>前面也已经看到从 GDC 检索和获取数据的中心就是指定返回哪些字段，根据字段和值进行筛选并进行聚合统计。GenomicDataCommons 有两个简单的函数：<code>available_fields()</code> 和 <code>default_fields()</code>，这两个函数的参数可以是代表访问点（endpoint）名称的字符（“cases”, “files”, “annotations”, 或 “projects”）或者是 <code>GDCQuery</code> 对象，返回相应的字段名称：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs r">default_fields<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;files&#x27;</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;access&quot;</span>                         <span class="hljs-string">&quot;acl&quot;</span>                            <span class="hljs-string">&quot;average_base_quality&quot;</span>          <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">4</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;average_insert_size&quot;</span>            <span class="hljs-string">&quot;average_read_length&quot;</span>            <span class="hljs-string">&quot;channel&quot;</span>                       <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">7</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;chip_id&quot;</span>                        <span class="hljs-string">&quot;chip_position&quot;</span>                  <span class="hljs-string">&quot;contamination&quot;</span>                 <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;contamination_error&quot;</span>            <span class="hljs-string">&quot;created_datetime&quot;</span>               <span class="hljs-string">&quot;data_category&quot;</span>                 <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">13</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;data_format&quot;</span>                    <span class="hljs-string">&quot;data_type&quot;</span>                      <span class="hljs-string">&quot;error_type&quot;</span>                    <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">16</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;experimental_strategy&quot;</span>          <span class="hljs-string">&quot;file_autocomplete&quot;</span>              <span class="hljs-string">&quot;file_id&quot;</span>                       <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">19</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;file_name&quot;</span>                      <span class="hljs-string">&quot;file_size&quot;</span>                      <span class="hljs-string">&quot;imaging_date&quot;</span>                  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">22</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;magnification&quot;</span>                  <span class="hljs-string">&quot;md5sum&quot;</span>                         <span class="hljs-string">&quot;mean_coverage&quot;</span>                 <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">25</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;msi_score&quot;</span>                      <span class="hljs-string">&quot;msi_status&quot;</span>                     <span class="hljs-string">&quot;pairs_on_diff_chr&quot;</span>             <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">28</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;plate_name&quot;</span>                     <span class="hljs-string">&quot;plate_well&quot;</span>                     <span class="hljs-string">&quot;platform&quot;</span>                      <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">31</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;proportion_base_mismatch&quot;</span>       <span class="hljs-string">&quot;proportion_coverage_10x&quot;</span>        <span class="hljs-string">&quot;proportion_coverage_10X&quot;</span>       <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">34</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;proportion_coverage_30x&quot;</span>        <span class="hljs-string">&quot;proportion_coverage_30X&quot;</span>        <span class="hljs-string">&quot;proportion_reads_duplicated&quot;</span>   <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">37</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;proportion_reads_mapped&quot;</span>        <span class="hljs-string">&quot;proportion_targets_no_coverage&quot;</span> <span class="hljs-string">&quot;read_pair_number&quot;</span>              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">40</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;revision&quot;</span>                       <span class="hljs-string">&quot;stain_type&quot;</span>                     <span class="hljs-string">&quot;state&quot;</span>                         <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">43</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;state_comment&quot;</span>                  <span class="hljs-string">&quot;submitter_id&quot;</span>                   <span class="hljs-string">&quot;tags&quot;</span>                          <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">46</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;total_reads&quot;</span>                    <span class="hljs-string">&quot;tumor_ploidy&quot;</span>                   <span class="hljs-string">&quot;tumor_purity&quot;</span>                  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">49</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;type&quot;</span>                           <span class="hljs-string">&quot;updated_datetime&quot;</span><br><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>available_fields<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;files&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">981</span><br>head<span class="hljs-punctuation">(</span>available_fields<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;files&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;access&quot;</span>                      <span class="hljs-string">&quot;acl&quot;</span>                         <span class="hljs-string">&quot;analysis.analysis_id&quot;</span>        <span class="hljs-string">&quot;analysis.analysis_type&quot;</span>     <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.created_datetime&quot;</span>   <span class="hljs-string">&quot;analysis.input_files.access&quot;</span><br></code></pre></td></tr></table></figure>

<p>知道有哪些字段后，我们就可以通过 <code>select</code> 动词来选择需要的字段；注意，这里的 <code>select</code> 和 <code>dplyr</code> 的<code>select</code> 并不是完全一样的，后者的 <code>select</code> 只能选择已经展示的字段，而这里的 <code>select</code> 可以所有的可选字段（也就是 default 和 available 的区别）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs r">qcases <span class="hljs-operator">=</span> cases<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>qcases<span class="hljs-operator">$</span>fields<span class="hljs-comment">##Default fields </span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;aliquot_ids&quot;</span>              <span class="hljs-string">&quot;analyte_ids&quot;</span>              <span class="hljs-string">&quot;case_autocomplete&quot;</span>        <span class="hljs-string">&quot;case_id&quot;</span>                 <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;consent_type&quot;</span>             <span class="hljs-string">&quot;created_datetime&quot;</span>         <span class="hljs-string">&quot;days_to_consent&quot;</span>          <span class="hljs-string">&quot;days_to_lost_to_followup&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">9</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;diagnosis_ids&quot;</span>            <span class="hljs-string">&quot;disease_type&quot;</span>             <span class="hljs-string">&quot;index_date&quot;</span>               <span class="hljs-string">&quot;lost_to_followup&quot;</span>        <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">13</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;portion_ids&quot;</span>              <span class="hljs-string">&quot;primary_site&quot;</span>             <span class="hljs-string">&quot;sample_ids&quot;</span>               <span class="hljs-string">&quot;slide_ids&quot;</span>               <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">17</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;state&quot;</span>                    <span class="hljs-string">&quot;submitter_aliquot_ids&quot;</span>    <span class="hljs-string">&quot;submitter_analyte_ids&quot;</span>    <span class="hljs-string">&quot;submitter_diagnosis_ids&quot;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">21</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;submitter_id&quot;</span>             <span class="hljs-string">&quot;submitter_portion_ids&quot;</span>    <span class="hljs-string">&quot;submitter_sample_ids&quot;</span>     <span class="hljs-string">&quot;submitter_slide_ids&quot;</span>     <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">25</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;updated_datetime&quot;</span><br><br>default_fields<span class="hljs-punctuation">(</span>qcases<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;aliquot_ids&quot;</span>              <span class="hljs-string">&quot;analyte_ids&quot;</span>              <span class="hljs-string">&quot;case_autocomplete&quot;</span>        <span class="hljs-string">&quot;case_id&quot;</span>                 <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;consent_type&quot;</span>             <span class="hljs-string">&quot;created_datetime&quot;</span>         <span class="hljs-string">&quot;days_to_consent&quot;</span>          <span class="hljs-string">&quot;days_to_lost_to_followup&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">9</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;diagnosis_ids&quot;</span>            <span class="hljs-string">&quot;disease_type&quot;</span>             <span class="hljs-string">&quot;index_date&quot;</span>               <span class="hljs-string">&quot;lost_to_followup&quot;</span>        <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">13</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;portion_ids&quot;</span>              <span class="hljs-string">&quot;primary_site&quot;</span>             <span class="hljs-string">&quot;sample_ids&quot;</span>               <span class="hljs-string">&quot;slide_ids&quot;</span>               <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">17</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;state&quot;</span>                    <span class="hljs-string">&quot;submitter_aliquot_ids&quot;</span>    <span class="hljs-string">&quot;submitter_analyte_ids&quot;</span>    <span class="hljs-string">&quot;submitter_diagnosis_ids&quot;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">21</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;submitter_id&quot;</span>             <span class="hljs-string">&quot;submitter_portion_ids&quot;</span>    <span class="hljs-string">&quot;submitter_sample_ids&quot;</span>     <span class="hljs-string">&quot;submitter_slide_ids&quot;</span>     <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">25</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;updated_datetime&quot;</span><br><br><span class="hljs-comment">##可以选择default field中没有的字段</span><br>qcases <span class="hljs-operator">=</span> cases<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> GenomicDataCommons<span class="hljs-operator">::</span>select<span class="hljs-punctuation">(</span>available_fields<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;cases&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>head<span class="hljs-punctuation">(</span>qcases<span class="hljs-operator">$</span>fields<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;case_id&quot;</span>                       <span class="hljs-string">&quot;aliquot_ids&quot;</span>                   <span class="hljs-string">&quot;analyte_ids&quot;</span>                  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">4</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;annotations.annotation_id&quot;</span>     <span class="hljs-string">&quot;annotations.case_id&quot;</span>           <span class="hljs-string">&quot;annotations.case_submitter_id&quot;</span><br></code></pre></td></tr></table></figure>

<p>由于检索字段在下载数据过程中是一个常用的操作，因此该包提供了一些函数来快速的找到想要的字段，如<br><code>grep_fields()</code> 和 <code>field_picker()</code> （貌似现在的版本已经把 <code>field_picker()</code> 函数给删了）。</p>
<h3 id="聚合统计"><a href="#聚合统计" class="headerlink" title="聚合统计"></a>聚合统计</h3><p>结合 <code>facet</code> 和 <code>aggregations()</code> 可以对一个或多个字段中的值进行统计，类似 base R 中的 <code>table</code> 操作（但是一次只能对一个字段操作，不能进行交叉操作），返回一个数据框（tibbles）:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs r">res <span class="hljs-operator">=</span> files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> facet<span class="hljs-punctuation">(</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;type&#x27;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&#x27;data_type&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> aggregations<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>res<span class="hljs-operator">$</span>type<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>    doc_count                           key<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>     <span class="hljs-number">151568</span>    annotated_somatic_mutation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>      <span class="hljs-number">89689</span>       simple_somatic_mutation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span>      <span class="hljs-number">87849</span>                 aligned_reads<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span>      <span class="hljs-number">66555</span>               gene_expression<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>      <span class="hljs-number">58540</span>           copy_number_segment<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span>      <span class="hljs-number">45843</span>          copy_number_estimate<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">7</span>      <span class="hljs-number">32268</span>              mirna_expression<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>      <span class="hljs-number">30075</span>                   slide_image<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">9</span>      <span class="hljs-number">25837</span>        biospecimen_supplement<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>     <span class="hljs-number">14750</span>          structural_variation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">11</span>     <span class="hljs-number">13732</span>        methylation_beta_value<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">12</span>     <span class="hljs-number">12962</span>           clinical_supplement<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">13</span>      <span class="hljs-number">7906</span>            protein_expression<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">14</span>      <span class="hljs-number">4410</span>   aggregated_somatic_mutation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">15</span>      <span class="hljs-number">4368</span>       masked_somatic_mutation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">16</span>      <span class="hljs-number">2746</span>      masked_methylation_array<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">17</span>        <span class="hljs-number">54</span> secondary_expression_analysis<br></code></pre></td></tr></table></figure>

<p>使用 <code>aggregations()</code> 可以方便的统计一个字段中有哪些值，有利于我们后续的针对字段的筛选。</p>
<h3 id="筛选"><a href="#筛选" class="headerlink" title="筛选"></a>筛选</h3><p>GenomicDataCommons 提供了和 dplyr 的 filter 同名且类似的函数 <code>filter()</code> 用来对特定的字段的值进行筛选，比如只想要上面的 <code>type</code> 中的 <code>gene_expression</code> 数据，就可以这样来筛选：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs r">qfiles <span class="hljs-operator">=</span> files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> filter<span class="hljs-punctuation">(</span> type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;gene_expression&#x27;</span><span class="hljs-punctuation">)</span><br>str<span class="hljs-punctuation">(</span>get_filter<span class="hljs-punctuation">(</span>qfiles<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> op     <span class="hljs-operator">:</span> <span class="hljs-string">&#x27;scalar&#x27;</span> chr <span class="hljs-string">&quot;=&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> content<span class="hljs-operator">:</span>List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> field<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;type&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> value<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;gene_expression&quot;</span><br></code></pre></td></tr></table></figure>

<p>如果我们现在想要基于某个 TCGA 的测序项目来构建过滤器（比如 TCGA-OV），但是不知道具体的字段名称是什么，这时候就可以使用上面提到的 <code>grep_fields()</code> 来查找可能的字段：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs r">grep_fields<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;files&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;project&quot;</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;cases.project.dbgap_accession_number&quot;</span>         <span class="hljs-string">&quot;cases.project.disease_type&quot;</span>                  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;cases.project.intended_release_date&quot;</span>          <span class="hljs-string">&quot;cases.project.name&quot;</span>                          <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;cases.project.primary_site&quot;</span>                   <span class="hljs-string">&quot;cases.project.program.dbgap_accession_number&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">7</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;cases.project.program.name&quot;</span>                   <span class="hljs-string">&quot;cases.project.program.program_id&quot;</span>            <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">9</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;cases.project.project_id&quot;</span>                     <span class="hljs-string">&quot;cases.project.releasable&quot;</span>                    <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">11</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;cases.project.released&quot;</span>                       <span class="hljs-string">&quot;cases.project.state&quot;</span>                         <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">13</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;cases.tissue_source_site.project&quot;</span><br></code></pre></td></tr></table></figure>

<p>看起来 <code>cases.project.project_id</code> 有可能符合我们的要求，接着再用 <code>facet</code> 和 <code>aggregations</code> 来检查该字段中有没有我们想要的值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs r">files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    facet<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;cases.project.project_id&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    aggregations<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    head<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">$</span>cases.project.project_id<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>    doc_count                   key<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>      <span class="hljs-number">36134</span>                 FM<span class="hljs-operator">-</span>AD<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>      <span class="hljs-number">34686</span>             TCGA<span class="hljs-operator">-</span>BRCA<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span>      <span class="hljs-number">45952</span>               CPTAC<span class="hljs-operator">-</span><span class="hljs-number">3</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span>      <span class="hljs-number">18723</span>             TCGA<span class="hljs-operator">-</span>LUAD<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>      <span class="hljs-number">36470</span>             GENIE<span class="hljs-operator">-</span>MSK<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span>      <span class="hljs-number">17717</span>             TCGA<span class="hljs-operator">-</span>UCEC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">7</span>      <span class="hljs-number">16694</span>             TCGA<span class="hljs-operator">-</span>HNSC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>      <span class="hljs-number">16776</span>               TCGA<span class="hljs-operator">-</span>OV<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">9</span>      <span class="hljs-number">15826</span>             TCGA<span class="hljs-operator">-</span>THCA<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>     <span class="hljs-number">29433</span>         MMRF<span class="hljs-operator">-</span>COMMPASS<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">11</span>     <span class="hljs-number">16696</span>             TCGA<span class="hljs-operator">-</span>LUSC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">12</span>     <span class="hljs-number">16230</span>              TCGA<span class="hljs-operator">-</span>LGG<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">13</span>     <span class="hljs-number">16733</span>             TCGA<span class="hljs-operator">-</span>KIRC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">14</span>     <span class="hljs-number">28464</span>            GENIE<span class="hljs-operator">-</span>DFCI<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">15</span>     <span class="hljs-number">15648</span>             TCGA<span class="hljs-operator">-</span>PRAD<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">16</span>     <span class="hljs-number">15701</span>             TCGA<span class="hljs-operator">-</span>COAD<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">17</span>     <span class="hljs-number">13332</span>              TCGA<span class="hljs-operator">-</span>GBM<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">18</span>     <span class="hljs-number">20772</span>         TARGET<span class="hljs-operator">-</span>ALL<span class="hljs-operator">-</span>P2<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">19</span>     <span class="hljs-number">14025</span>             TCGA<span class="hljs-operator">-</span>SKCM<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>     <span class="hljs-number">14096</span>             TCGA<span class="hljs-operator">-</span>STAD<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">21</span>     <span class="hljs-number">12856</span>             TCGA<span class="hljs-operator">-</span>BLCA<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">22</span>     <span class="hljs-number">11762</span>             TCGA<span class="hljs-operator">-</span>LIHC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">23</span>      <span class="hljs-number">9373</span>             TCGA<span class="hljs-operator">-</span>CESC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">24</span>      <span class="hljs-number">9353</span>             TCGA<span class="hljs-operator">-</span>KIRP<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>      <span class="hljs-number">8228</span>             TCGA<span class="hljs-operator">-</span>SARC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">26</span>     <span class="hljs-number">14037</span>             REBC<span class="hljs-operator">-</span>THYR<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">27</span>      <span class="hljs-number">8142</span>            TARGET<span class="hljs-operator">-</span>AML<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">28</span>      <span class="hljs-number">5791</span>             TCGA<span class="hljs-operator">-</span>PAAD<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">29</span>      <span class="hljs-number">5783</span>             TCGA<span class="hljs-operator">-</span>ESCA<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span>      <span class="hljs-number">5460</span>             TCGA<span class="hljs-operator">-</span>PCPG<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">31</span>      <span class="hljs-number">5401</span>             TCGA<span class="hljs-operator">-</span>READ<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">32</span>      <span class="hljs-number">9888</span>               CPTAC<span class="hljs-operator">-</span><span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">33</span>      <span class="hljs-number">5978</span>             TCGA<span class="hljs-operator">-</span>TGCT<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">34</span>      <span class="hljs-number">8981</span>     BEATAML1.0<span class="hljs-operator">-</span>COHORT<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">35</span>      <span class="hljs-number">5792</span>            TARGET<span class="hljs-operator">-</span>NBL<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">36</span>      <span class="hljs-number">8167</span>             HCMI<span class="hljs-operator">-</span>CMDC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">37</span>      <span class="hljs-number">4814</span>             TCGA<span class="hljs-operator">-</span>LAML<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">38</span>      <span class="hljs-number">5771</span>         CGCI<span class="hljs-operator">-</span>HTMCP<span class="hljs-operator">-</span>CC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">39</span>      <span class="hljs-number">3781</span>             TCGA<span class="hljs-operator">-</span>THYM<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">40</span>      <span class="hljs-number">5941</span>               CMI<span class="hljs-operator">-</span>MBC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">41</span>      <span class="hljs-number">2782</span>              TCGA<span class="hljs-operator">-</span>ACC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">42</span>      <span class="hljs-number">2520</span>             TCGA<span class="hljs-operator">-</span>KICH<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">43</span>      <span class="hljs-number">2677</span>             TARGET<span class="hljs-operator">-</span>WT<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">44</span>      <span class="hljs-number">4805</span>          NCICCR<span class="hljs-operator">-</span>DLBCL<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">45</span>      <span class="hljs-number">2580</span>             TCGA<span class="hljs-operator">-</span>MESO<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">46</span>      <span class="hljs-number">2352</span>              TCGA<span class="hljs-operator">-</span>UVM<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">47</span>      <span class="hljs-number">3113</span>             TARGET<span class="hljs-operator">-</span>OS<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">48</span>      <span class="hljs-number">3982</span>         TARGET<span class="hljs-operator">-</span>ALL<span class="hljs-operator">-</span>P3<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">49</span>      <span class="hljs-number">3857</span>             GENIE<span class="hljs-operator">-</span>MDA<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span>      <span class="hljs-number">3833</span>            GENIE<span class="hljs-operator">-</span>VICC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">51</span>      <span class="hljs-number">1813</span>              TCGA<span class="hljs-operator">-</span>UCS<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">52</span>      <span class="hljs-number">3320</span>             GENIE<span class="hljs-operator">-</span>JHU<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">53</span>      <span class="hljs-number">1456</span>             TCGA<span class="hljs-operator">-</span>CHOL<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">54</span>      <span class="hljs-number">2632</span>             GENIE<span class="hljs-operator">-</span>UHN<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">55</span>      <span class="hljs-number">1358</span>             TCGA<span class="hljs-operator">-</span>DLBC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">56</span>      <span class="hljs-number">2477</span>            CGCI<span class="hljs-operator">-</span>BLGSP<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">57</span>      <span class="hljs-number">1049</span>             TARGET<span class="hljs-operator">-</span>RT<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">58</span>      <span class="hljs-number">1038</span>            GENIE<span class="hljs-operator">-</span>GRCC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">59</span>       <span class="hljs-number">994</span>            WCDT<span class="hljs-operator">-</span>MCRPC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">60</span>       <span class="hljs-number">934</span>               CMI<span class="hljs-operator">-</span>ASC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">61</span>       <span class="hljs-number">801</span>             GENIE<span class="hljs-operator">-</span>NKI<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">62</span>       <span class="hljs-number">798</span>              OHSU<span class="hljs-operator">-</span>CNL<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">63</span>       <span class="hljs-number">703</span>   ORGANOID<span class="hljs-operator">-</span>PANCREATIC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">64</span>       <span class="hljs-number">570</span>               CMI<span class="hljs-operator">-</span>MPC<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">65</span>       <span class="hljs-number">417</span>           CTSP<span class="hljs-operator">-</span>DLBCL1<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">66</span>       <span class="hljs-number">339</span>              TRIO<span class="hljs-operator">-</span>CRU<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">67</span>       <span class="hljs-number">222</span> BEATAML1.0<span class="hljs-operator">-</span>CRENOLANIB<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">68</span>       <span class="hljs-number">169</span>           TARGET<span class="hljs-operator">-</span>CCSK<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">69</span>       <span class="hljs-number">133</span>         TARGET<span class="hljs-operator">-</span>ALL<span class="hljs-operator">-</span>P1<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">70</span>        <span class="hljs-number">21</span>        VAREPOP<span class="hljs-operator">-</span>APOLLO<br></code></pre></td></tr></table></figure>

<p>这个字段确实是有 <code>TCGA-OV</code> 的，然后就可以基于这个字段的值使用 <code>filter</code> 获取想要的数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs r">qfiles <span class="hljs-operator">=</span> files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>    filter<span class="hljs-punctuation">(</span> cases.project.project_id <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;TCGA-OV&#x27;</span> <span class="hljs-operator">&amp;</span> type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;gene_expression&#x27;</span><span class="hljs-punctuation">)</span><br>str<span class="hljs-punctuation">(</span>get_filter<span class="hljs-punctuation">(</span>qfiles<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> op     <span class="hljs-operator">:</span> <span class="hljs-string">&#x27;scalar&#x27;</span> chr <span class="hljs-string">&quot;and&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-operator">$</span> content<span class="hljs-operator">:</span>List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> <span class="hljs-operator">:</span>List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. ..<span class="hljs-operator">$</span> op     <span class="hljs-operator">:</span> <span class="hljs-string">&#x27;scalar&#x27;</span> chr <span class="hljs-string">&quot;=&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. ..<span class="hljs-operator">$</span> content<span class="hljs-operator">:</span>List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. .. ..<span class="hljs-operator">$</span> field<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;cases.project.project_id&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. .. ..<span class="hljs-operator">$</span> value<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;TCGA-OV&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   ..<span class="hljs-operator">$</span> <span class="hljs-operator">:</span>List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. ..<span class="hljs-operator">$</span> op     <span class="hljs-operator">:</span> <span class="hljs-string">&#x27;scalar&#x27;</span> chr <span class="hljs-string">&quot;=&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. ..<span class="hljs-operator">$</span> content<span class="hljs-operator">:</span>List of <span class="hljs-number">2</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. .. ..<span class="hljs-operator">$</span> field<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;type&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   .. .. ..<span class="hljs-operator">$</span> value<span class="hljs-operator">:</span> chr <span class="hljs-string">&quot;gene_expression&quot;</span><br><br>qfiles <span class="hljs-operator">%&gt;%</span> count<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">1137</span><br><br><span class="hljs-comment">##使用多次filter也是可以的</span><br>qfiles2 <span class="hljs-operator">=</span> files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>    filter<span class="hljs-punctuation">(</span> cases.project.project_id <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;TCGA-OV&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    filter<span class="hljs-punctuation">(</span> type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;gene_expression&#x27;</span><span class="hljs-punctuation">)</span> <br>qfiles2 <span class="hljs-operator">%&gt;%</span> count<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">1137</span><br></code></pre></td></tr></table></figure>

<p>检索到数据后就可以使用 <code>manidfest()</code>来基于当前的请求构建需要下载数据的元数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs r">manifest_df <span class="hljs-operator">=</span> qfiles <span class="hljs-operator">%&gt;%</span> manifest<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">1137</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br>head<span class="hljs-punctuation">(</span>manifest_df<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># A tibble: 6 × 5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   id                                   filename                                             md5                      size state <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                                <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                                                <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                   <span class="hljs-operator">&lt;</span>dbl<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span>c099182<span class="hljs-operator">-</span><span class="hljs-number">703</span>f<span class="hljs-operator">-</span><span class="hljs-number">4</span>aaf<span class="hljs-operator">-</span>b1d6<span class="hljs-operator">-</span><span class="hljs-number">0</span>f9be5094b9a fea3c4d0<span class="hljs-operator">-</span><span class="hljs-number">7</span>b9f<span class="hljs-operator">-</span><span class="hljs-number">4279</span><span class="hljs-operator">-</span><span class="hljs-number">989e-535</span>aaefbdfeb.FPKM.txt.gz     a344c91e930a0217efa2b… <span class="hljs-number">506691</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span> <span class="hljs-number">02</span>ab2f95<span class="hljs-operator">-</span><span class="hljs-number">023</span>b<span class="hljs-operator">-</span><span class="hljs-number">492e-8</span>dc9<span class="hljs-operator">-</span><span class="hljs-number">20</span>b4f52f209f b1d5c444<span class="hljs-operator">-</span>da0d<span class="hljs-operator">-</span><span class="hljs-number">4360</span><span class="hljs-operator">-</span>bd45<span class="hljs-operator">-</span><span class="hljs-number">31</span>c94217adfc.FPKM<span class="hljs-operator">-</span>UQ.txt.gz  <span class="hljs-number">45</span>d6b0fcc30607948a53b… <span class="hljs-number">547204</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> <span class="hljs-number">30</span>c9def0<span class="hljs-operator">-</span>c3b5<span class="hljs-operator">-</span><span class="hljs-number">45</span>b7<span class="hljs-operator">-</span>a427<span class="hljs-operator">-</span><span class="hljs-number">020</span>b735c836a ab8603dd<span class="hljs-operator">-</span><span class="hljs-number">2</span>f94<span class="hljs-operator">-</span><span class="hljs-number">4</span>c83<span class="hljs-operator">-</span><span class="hljs-number">9927</span><span class="hljs-operator">-</span><span class="hljs-number">455958</span>be0007.FPKM.txt.gz     c82b63def1fcc6b9d3b52… <span class="hljs-number">503463</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span> <span class="hljs-number">451</span>c9c6d<span class="hljs-operator">-</span>f062<span class="hljs-operator">-</span><span class="hljs-number">4</span>ca2<span class="hljs-operator">-</span><span class="hljs-number">8459</span><span class="hljs-operator">-</span>efed929bd305 <span class="hljs-number">9</span>c6f2d76<span class="hljs-operator">-</span><span class="hljs-number">7701</span><span class="hljs-operator">-</span><span class="hljs-number">434</span>e<span class="hljs-operator">-</span>a876<span class="hljs-operator">-</span>c04ab14cccea.htseq.counts.gz d296b0cb99d14b4b91383… <span class="hljs-number">263970</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-number">75</span>c0968c<span class="hljs-operator">-</span><span class="hljs-number">51</span>aa<span class="hljs-operator">-</span><span class="hljs-number">4</span>f09<span class="hljs-operator">-</span><span class="hljs-number">812</span>f<span class="hljs-operator">-</span><span class="hljs-number">7</span>f85727d1e09 <span class="hljs-number">5</span>b23f813<span class="hljs-operator">-</span><span class="hljs-number">9970</span><span class="hljs-operator">-</span><span class="hljs-number">485</span>b<span class="hljs-operator">-</span><span class="hljs-number">8577</span><span class="hljs-operator">-</span>ab2f3c029c26.FPKM<span class="hljs-operator">-</span>UQ.txt.gz  <span class="hljs-number">736</span>a8c6706423a7c1ff40… <span class="hljs-number">559501</span> relea…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span> <span class="hljs-number">57</span>d791ef<span class="hljs-operator">-</span>c2cc<span class="hljs-operator">-</span><span class="hljs-number">4963</span><span class="hljs-operator">-</span>a618<span class="hljs-operator">-</span><span class="hljs-number">05</span>f92d5a4436 <span class="hljs-number">6</span>aa7225b<span class="hljs-operator">-</span><span class="hljs-number">3</span>d10<span class="hljs-operator">-</span><span class="hljs-number">4</span>b19<span class="hljs-operator">-</span>a472<span class="hljs-operator">-</span><span class="hljs-number">0</span>adeb21c26cf.FPKM<span class="hljs-operator">-</span>UQ.txt.gz  <span class="hljs-number">8</span>b44a1f944fc78b39e0f9… <span class="hljs-number">536734</span> relea…<br></code></pre></td></tr></table></figure>

<p>可以看到返回的结果中既有 FPKM 又有 FPKM-UQ 和 counts，比较混乱，可以进行进一步的筛选：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs r">grep_fields<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;files&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;workflow&quot;</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.metadata.read_groups.read_group_qcs.workflow_end_datetime&quot;</span>  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.metadata.read_groups.read_group_qcs.workflow_link&quot;</span>          <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.metadata.read_groups.read_group_qcs.workflow_start_datetime&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">4</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.metadata.read_groups.read_group_qcs.workflow_type&quot;</span>          <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.metadata.read_groups.read_group_qcs.workflow_version&quot;</span>       <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">6</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.workflow_end_datetime&quot;</span>                                      <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">7</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.workflow_link&quot;</span>                                              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">8</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.workflow_start_datetime&quot;</span>                                    <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-punctuation">[</span><span class="hljs-number">9</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.workflow_type&quot;</span>                                              <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;analysis.workflow_version&quot;</span>                                           <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">11</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;downstream_analyses.workflow_end_datetime&quot;</span>                           <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">12</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;downstream_analyses.workflow_link&quot;</span>                                   <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">13</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;downstream_analyses.workflow_start_datetime&quot;</span>                         <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">14</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;downstream_analyses.workflow_type&quot;</span>                                   <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">15</span><span class="hljs-punctuation">]</span> <span class="hljs-string">&quot;downstream_analyses.workflow_version&quot;</span><br><br><span class="hljs-comment">##analysis.workflow_type</span><br>files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    filter<span class="hljs-punctuation">(</span> cases.project.project_id <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;TCGA-OV&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    filter<span class="hljs-punctuation">(</span> type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;gene_expression&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    facet<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;analysis.workflow_type&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    aggregations<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    head<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">$</span>analysis.workflow_type<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>    doc_count                                           key<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>       <span class="hljs-number">2400</span>                                       DNAcopy<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>       <span class="hljs-number">1178</span>                                        ASCAT2<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span>       <span class="hljs-number">1051</span>       BWA with Mark Duplicates and Cocleaning<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span>        <span class="hljs-number">998</span>                         BCGSC miRNA Profiling<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>        <span class="hljs-number">623</span>                                      Liftover<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span>        <span class="hljs-number">610</span>                                       MuTect2<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">7</span>        <span class="hljs-number">610</span>                            MuTect2 Annotation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>        <span class="hljs-number">610</span>                                 SomaticSniper<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">9</span>        <span class="hljs-number">610</span>                      SomaticSniper Annotation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>       <span class="hljs-number">610</span>                                      VarScan2<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">11</span>       <span class="hljs-number">610</span>                           VarScan2 Annotation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">12</span>       <span class="hljs-number">606</span>                                          MuSE<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">13</span>       <span class="hljs-number">606</span>                               MuSE Annotation<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">14</span>       <span class="hljs-number">499</span>                                       BWA<span class="hljs-operator">-</span>aln<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">15</span>       <span class="hljs-number">379</span>                                HTSeq <span class="hljs-operator">-</span> Counts<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">16</span>       <span class="hljs-number">379</span>                                  HTSeq <span class="hljs-operator">-</span> FPKM<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">17</span>       <span class="hljs-number">379</span>                               HTSeq <span class="hljs-operator">-</span> FPKM<span class="hljs-operator">-</span>UQ<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">18</span>       <span class="hljs-number">379</span>                                   STAR <span class="hljs-number">2</span><span class="hljs-operator">-</span>Pass<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">19</span>         <span class="hljs-number">2</span>          MuSE Variant Aggregation and Masking<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>         <span class="hljs-number">2</span>       MuTect2 Variant Aggregation and Masking<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">21</span>         <span class="hljs-number">2</span> SomaticSniper Variant Aggregation and Masking<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">22</span>         <span class="hljs-number">2</span>      VarScan2 Variant Aggregation and Masking<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">23</span>         <span class="hljs-number">1</span>                    GISTIC <span class="hljs-operator">-</span> Copy Number Score<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">24</span>      <span class="hljs-number">3630</span>                                      _<span class="hljs-built_in">missing</span><br><br><span class="hljs-comment">##HTSeq - Counts</span><br>qfiles <span class="hljs-operator">=</span> files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> filter<span class="hljs-punctuation">(</span> <span class="hljs-operator">~</span> cases.project.project_id <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;TCGA-OV&#x27;</span> <span class="hljs-operator">&amp;</span><br>                            type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;gene_expression&#x27;</span> <span class="hljs-operator">&amp;</span><br>                            analysis.workflow_type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;HTSeq - Counts&#x27;</span><span class="hljs-punctuation">)</span><br>manifest_df <span class="hljs-operator">=</span> qfiles <span class="hljs-operator">%&gt;%</span> manifest<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">379</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br>nrow<span class="hljs-punctuation">(</span>manifest_df<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span> <span class="hljs-number">379</span><br></code></pre></td></tr></table></figure>

<h2 id="设置-Token"><a href="#设置-Token" class="headerlink" title="设置 Token"></a>设置 Token</h2><p>GDC 的数据分为 <code>controlled-access</code> 和 <code>open</code> 两种类型；要下载 <code>controlled-access</code> 的数据，需要一个 Token 文件，该文件可以从 GDC 官网下载（登录账号之后）：</p>
<p><img src="https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-08%20134754.png" srcset="/img/loading.gif" lazyload></p>
<p>然后可以用 <code>gdc_token()</code> 函数来导入 Token，该函数以下面三种方式依次来找 token，如果没有找到则报错：</p>
<ul>
<li>以环境变量 <code>GDC_TOKEN</code> 保存字符形式的 token</li>
<li>以环境变量 <code>GDC_TOKEN_FILE</code> 保存的 token 文件名来找 token</li>
<li>在在家目录下找以文件名 <code>.gdc_token</code> 保存的 token 文件</li>
</ul>
<p>以第三种为例，将下载的 token 文件重命名为 <code>.gdc_token</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> data/gdc-user-token.2022-01-08T06_55_22.799Z.txt .gdc_token<br></code></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">token <span class="hljs-operator">=</span> gdc_token<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure>

<h2 id="数据文件下载"><a href="#数据文件下载" class="headerlink" title="数据文件下载"></a>数据文件下载</h2><h3 id="通过-GDC-API-下载数据"><a href="#通过-GDC-API-下载数据" class="headerlink" title="通过 GDC API 下载数据"></a>通过 GDC API 下载数据</h3><p><code>gdcdata</code> 可以接受含有一个或多个文件 UUID 的字符向量进行文件的下载，生成该字符向量的简单方式就是把上面获得的元数据的第一列拿出来就行：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs r">fnames <span class="hljs-operator">=</span> gdcdata<span class="hljs-punctuation">(</span>manifest_df<span class="hljs-operator">$</span>id<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>progress<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">2</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br></code></pre></td></tr></table></figure>

<p>如果要下载 control 的数据，则需要提供 token（上面通过 <code>gdc_token</code> 得到的字符串）；另外可以使用<code>BioCParallel</code> 进行多线程下载来缩短下载的时间。</p>
<h3 id="大数据的下载"><a href="#大数据的下载" class="headerlink" title="大数据的下载"></a>大数据的下载</h3><p>当需要下载体积巨大的数据，比如测序的 BAM 文件或者 较大的 VCF 文件时，可以使用 <code>client</code> 的下载方法：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs r">fnames <span class="hljs-operator">=</span> gdcdata<span class="hljs-punctuation">(</span>manifest_df<span class="hljs-operator">$</span>id<span class="hljs-punctuation">[</span><span class="hljs-number">3</span><span class="hljs-operator">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> access_method <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;client&#x27;</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">8</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br></code></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这个包下载数据首先是要构建一个 query（请求），比如 <code>files()</code> 和 <code>cases()</code>，这些函数返回一个 GDCQuery 的 S3 对象，包含 filter, facets，和其他的参数；然后进行筛选，有几个重要的函数：filter 是根据 field 的值来选取记录；select 选择 field；expand 是 field 的聚合，提供了一些相关的 field 组成的 group，便于检索；facts 是统计 common vlaue，类似 table；接着就可以通过 <code>manifest()</code> 下载元数据，通过元数据下载真正的数据文件（<code>gdcdata</code>）</p>
<h1 id="案例：计算-TCGA-样本的测序深度"><a href="#案例：计算-TCGA-样本的测序深度" class="headerlink" title="案例：计算 TCGA 样本的测序深度"></a>案例：计算 TCGA 样本的测序深度</h1><p>测序深度的计算公式为：</p>
<p>$$<br>D&#x3D;\frac{L *N}{G}<br>$$<br>L 是 reads 的长度，N 是 reads 的数目，G 是测序目标区域的长度（比如全外显子，全基因组等）；因此对于 TCGA 的全外显子测序，我们需要知道样本测序读长的长度，reads 的总数目，目标区域就是外显子的长度。</p>
<p>首先需要得到样本测序读长的长度，也就是 reads length，这个信息可以从测序的元数据获取（代码参考<a target="_blank" rel="noopener" href="https://support.bioconductor.org/p/107984/">这里</a>）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs r">library<span class="hljs-punctuation">(</span>GenomicDataCommons<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment">##筛选数据，方便演示只选了样本量比较少的ACC,前20个样本</span><br>q <span class="hljs-operator">=</span> files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>    filter<span class="hljs-punctuation">(</span> cases.project.project_id <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;TCGA-ACC&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span><br>  filter<span class="hljs-punctuation">(</span>data_type <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;Aligned Reads&#x27;</span> <br>         <span class="hljs-operator">&amp;</span> experimental_strategy <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;WXS&#x27;</span> <br>         <span class="hljs-operator">&amp;</span> data_format <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;BAM&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  GenomicDataCommons<span class="hljs-operator">::</span>select<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;file_id&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  expand<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;analysis.metadata.read_groups&#x27;</span><span class="hljs-punctuation">)</span> <br><br>z <span class="hljs-operator">=</span> results<span class="hljs-punctuation">(</span>q<span class="hljs-punctuation">,</span>size<span class="hljs-operator">=</span><span class="hljs-number">20</span><span class="hljs-punctuation">)</span><br><br>library<span class="hljs-punctuation">(</span>dplyr<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Attaching package<span class="hljs-operator">:</span> <span class="hljs-string">&#x27;dplyr&#x27;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> The following objects are masked from <span class="hljs-string">&#x27;package:GenomicDataCommons&#x27;</span><span class="hljs-operator">:</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>     count<span class="hljs-punctuation">,</span> filter<span class="hljs-punctuation">,</span> select<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> The following objects are masked from <span class="hljs-string">&#x27;package:stats&#x27;</span><span class="hljs-operator">:</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>     filter<span class="hljs-punctuation">,</span> lag<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> The following objects are masked from <span class="hljs-string">&#x27;package:base&#x27;</span><span class="hljs-operator">:</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>     intersect<span class="hljs-punctuation">,</span> setdiff<span class="hljs-punctuation">,</span> setequal<span class="hljs-punctuation">,</span> union<br>t <span class="hljs-operator">&lt;-</span> z<span class="hljs-operator">$</span>analysis<span class="hljs-operator">$</span>metadata<span class="hljs-operator">$</span>read_groups<br><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>t<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> z<span class="hljs-operator">$</span>file_id<br>a <span class="hljs-operator">&lt;-</span> t <span class="hljs-operator">%&gt;%</span> bind_rows<span class="hljs-punctuation">(</span>.id <span class="hljs-operator">=</span> <span class="hljs-string">&quot;file_ids&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> as_tibble<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>head<span class="hljs-punctuation">(</span>a<span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># A tibble: 6 × 19</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   file_ids   sequencing_date experiment_name  target_capture_… submitter_id  target_capture_kit_… is_paired_end target_capture_…<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>   <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>      <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>           <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>            <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>            <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>         <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>                <span class="hljs-operator">&lt;</span>lgl<span class="hljs-operator">&gt;</span>         <span class="hljs-operator">&lt;</span>chr<span class="hljs-operator">&gt;</span>           <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-number">99818</span>fa6<span class="hljs-operator">-</span>… <span class="hljs-number">2013</span><span class="hljs-operator">-</span><span class="hljs-number">09</span><span class="hljs-operator">-</span><span class="hljs-number">12</span>T08   TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5KO<span class="hljs-operator">-</span><span class="hljs-number">01</span>… NimbleGen        efc0de29<span class="hljs-operator">-</span><span class="hljs-number">4</span>b5… http<span class="hljs-operator">:</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.nimblege… <span class="hljs-literal">TRUE</span>          <span class="hljs-number">06</span> <span class="hljs-number">465</span> <span class="hljs-number">668</span> <span class="hljs-number">001</span>  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span> a9f11831<span class="hljs-operator">-</span>… <span class="hljs-number">2013</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">05</span>T02   TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LD<span class="hljs-operator">-</span><span class="hljs-number">10</span>… NimbleGen        afc22b50<span class="hljs-operator">-</span><span class="hljs-number">442</span>… http<span class="hljs-operator">:</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.nimblege… <span class="hljs-literal">TRUE</span>          <span class="hljs-number">06</span> <span class="hljs-number">465</span> <span class="hljs-number">668</span> <span class="hljs-number">001</span>  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span>a14bcc9<span class="hljs-operator">-</span>… <span class="hljs-number">2013</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">12</span>T02   TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JJ<span class="hljs-operator">-</span><span class="hljs-number">10</span>… NimbleGen        <span class="hljs-number">17</span>fa8960<span class="hljs-operator">-</span><span class="hljs-number">7</span>a4… http<span class="hljs-operator">:</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.nimblege… <span class="hljs-literal">TRUE</span>          <span class="hljs-number">06</span> <span class="hljs-number">465</span> <span class="hljs-number">668</span> <span class="hljs-number">001</span>  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span> f3af7cc5<span class="hljs-operator">-</span>… <span class="hljs-number">2013</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">12</span>T03   TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JV<span class="hljs-operator">-</span><span class="hljs-number">10</span>… NimbleGen        b7c4c670<span class="hljs-operator">-</span><span class="hljs-number">624</span>… http<span class="hljs-operator">:</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.nimblege… <span class="hljs-literal">TRUE</span>          <span class="hljs-number">06</span> <span class="hljs-number">465</span> <span class="hljs-number">668</span> <span class="hljs-number">001</span>  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-number">870</span>c0429<span class="hljs-operator">-</span>… <span class="hljs-number">2013</span><span class="hljs-operator">-</span><span class="hljs-number">07</span><span class="hljs-operator">-</span><span class="hljs-number">29</span>T11   TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LP<span class="hljs-operator">-</span><span class="hljs-number">01</span>… NimbleGen        b99240a5<span class="hljs-operator">-</span><span class="hljs-number">473</span>… http<span class="hljs-operator">:</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.nimblege… <span class="hljs-literal">TRUE</span>          <span class="hljs-number">06</span> <span class="hljs-number">465</span> <span class="hljs-number">668</span> <span class="hljs-number">001</span>  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span> b1da0e48<span class="hljs-operator">-</span>… <span class="hljs-number">2013</span><span class="hljs-operator">-</span><span class="hljs-number">08</span><span class="hljs-operator">-</span><span class="hljs-number">06</span>T11   TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5L2<span class="hljs-operator">-</span><span class="hljs-number">01</span>… NimbleGen        b99bd79e<span class="hljs-operator">-</span>aa3… http<span class="hljs-operator">:</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.nimblege… <span class="hljs-literal">TRUE</span>          <span class="hljs-number">06</span> <span class="hljs-number">465</span> <span class="hljs-number">668</span> <span class="hljs-number">001</span>  <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment"># … with 11 more variables: library_strategy &lt;chr&gt;, platform &lt;chr&gt;, created_datetime &lt;chr&gt;, updated_datetime &lt;chr&gt;,</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment">#   read_group_name &lt;chr&gt;, library_name &lt;chr&gt;, target_capture_kit_name &lt;chr&gt;, sequencing_center &lt;chr&gt;, state &lt;chr&gt;,</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-comment">#   read_length &lt;int&gt;, read_group_id &lt;chr&gt;</span><br><br><span class="hljs-comment">##整理结果</span><br>re <span class="hljs-operator">&lt;-</span> a <span class="hljs-operator">%&gt;%</span> <br>  dplyr<span class="hljs-operator">::</span>select<span class="hljs-punctuation">(</span>experiment_name<span class="hljs-punctuation">,</span>read_length<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  mutate<span class="hljs-punctuation">(</span>sample<span class="hljs-operator">=</span>substr<span class="hljs-punctuation">(</span>experiment_name<span class="hljs-punctuation">,</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">16</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  distinct<span class="hljs-punctuation">(</span>sample<span class="hljs-punctuation">,</span>read_length<span class="hljs-punctuation">,</span>.keep_all <span class="hljs-operator">=</span> <span class="hljs-built_in">T</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  dplyr<span class="hljs-operator">::</span>filter<span class="hljs-punctuation">(</span>grepl<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;TCGA&quot;</span><span class="hljs-punctuation">,</span>sample<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  dplyr<span class="hljs-operator">::</span>filter<span class="hljs-punctuation">(</span><span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span>substr<span class="hljs-punctuation">(</span>sample<span class="hljs-punctuation">,</span><span class="hljs-number">14</span><span class="hljs-punctuation">,</span><span class="hljs-number">15</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;=</span> <span class="hljs-number">9</span><span class="hljs-punctuation">)</span><br><br>table<span class="hljs-punctuation">(</span>re<span class="hljs-operator">$</span>read_length<span class="hljs-punctuation">)</span> <span class="hljs-comment">##read length都是101</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">101</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>  <span class="hljs-number">13</span><br></code></pre></td></tr></table></figure>

<p>然后需要根据 BAI 文件得到 reads 总数目（源代码来自<a target="_blank" rel="noopener" href="https://www.biostars.org/p/9472253/">Coverage data for TCGA BAM files (biostars.org)</a>）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-comment">#get BAM file manifest</span><br>manifest <span class="hljs-operator">=</span> GenomicDataCommons<span class="hljs-operator">::</span>files<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span>  <br>  GenomicDataCommons<span class="hljs-operator">::</span>filter<span class="hljs-punctuation">(</span> cases.project.project_id <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;TCGA-ACC&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  GenomicDataCommons<span class="hljs-operator">::</span>filter<span class="hljs-punctuation">(</span>experimental_strategy <span class="hljs-operator">==</span> <span class="hljs-string">&quot;WXS&quot;</span> <span class="hljs-operator">&amp;</span><br>                               data_format <span class="hljs-operator">==</span> <span class="hljs-string">&quot;BAM&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span>   <br>  GenomicDataCommons<span class="hljs-operator">::</span>manifest<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Rows<span class="hljs-operator">:</span> <span class="hljs-number">184</span> Columns<span class="hljs-operator">:</span> <span class="hljs-number">5</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> Delimiter<span class="hljs-operator">:</span> <span class="hljs-string">&quot;\t&quot;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> chr <span class="hljs-punctuation">(</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> id<span class="hljs-punctuation">,</span> filename<span class="hljs-punctuation">,</span> md5<span class="hljs-punctuation">,</span> state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> dbl <span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> size<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Use `spec()` to retrieve the full column specification <span class="hljs-keyword">for</span> this data.<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.<br><br>dt <span class="hljs-operator">&lt;-</span> manifest <span class="hljs-operator">%&gt;%</span> <br>  mutate<span class="hljs-punctuation">(</span>tmp<span class="hljs-operator">=</span>gsub<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;.+[.]TCGA&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;TCGA&quot;</span><span class="hljs-punctuation">,</span>filename<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  mutate<span class="hljs-punctuation">(</span>sample<span class="hljs-operator">=</span>substr<span class="hljs-punctuation">(</span>tmp<span class="hljs-punctuation">,</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">16</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  dplyr<span class="hljs-operator">::</span>filter<span class="hljs-punctuation">(</span><span class="hljs-operator">!</span>grepl<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;hg19&quot;</span><span class="hljs-punctuation">,</span>filename<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  dplyr<span class="hljs-operator">::</span>filter<span class="hljs-punctuation">(</span>sample <span class="hljs-operator">%in%</span> re<span class="hljs-operator">$</span>sample<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure>

<p>由于 BAM 文件较大，而计算 mapped 的总 reads 数只需要 BAM 的索引文件（也就是 BAI 文件），因此我们下载 BAI 文件就行，但是 TCGA 并没有直接提供 BAI 文件的 UUID，因此我们需要进行进一步的处理。根据 GDC 官方的<a target="_blank" rel="noopener" href="https://gdc.cancer.gov/about-gdc/gdc-faqs">文档</a>显示，在用 api 下载 BAM 文件时在末尾加上 <code>?pretty=true&amp;expand=index_files</code>就可以得到一个含有 BAI 的 UUID 的 JSON 文件：</p>
<p><img src="https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/image-20220108143545648.png" srcset="/img/loading.gif" lazyload></p>
<p>因此我们可以利用这个特征来得到 BAI 的 UUID：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs r">res <span class="hljs-operator">&lt;-</span> vector<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;list&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>unique<span class="hljs-punctuation">(</span>dt<span class="hljs-operator">$</span>id<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-keyword">for</span> <span class="hljs-punctuation">(</span>i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>res<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span><br>  con <span class="hljs-operator">=</span> curl<span class="hljs-operator">::</span>curl<span class="hljs-punctuation">(</span>paste0<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;https://api.gdc.cancer.gov/files/&quot;</span><span class="hljs-punctuation">,</span> dt<span class="hljs-operator">$</span>id<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;?pretty=true&amp;expand=index_files&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>  tbl <span class="hljs-operator">=</span> jsonlite<span class="hljs-operator">::</span>fromJSON<span class="hljs-punctuation">(</span>con<span class="hljs-punctuation">)</span><br>  bai <span class="hljs-operator">=</span> data.frame<span class="hljs-punctuation">(</span>id <span class="hljs-operator">=</span> tbl<span class="hljs-operator">$</span>data<span class="hljs-operator">$</span>index_files<span class="hljs-operator">$</span>file_id<span class="hljs-punctuation">,</span><br>                   filename <span class="hljs-operator">=</span> tbl<span class="hljs-operator">$</span>data<span class="hljs-operator">$</span>index_files<span class="hljs-operator">$</span>file_name<span class="hljs-punctuation">,</span><br>                   md5 <span class="hljs-operator">=</span> tbl<span class="hljs-operator">$</span>data<span class="hljs-operator">$</span>index_files<span class="hljs-operator">$</span>md5sum<span class="hljs-punctuation">,</span><br>                   size <span class="hljs-operator">=</span> tbl<span class="hljs-operator">$</span>data<span class="hljs-operator">$</span>index_files<span class="hljs-operator">$</span>file_size<span class="hljs-punctuation">,</span><br>                   state <span class="hljs-operator">=</span> tbl<span class="hljs-operator">$</span>data<span class="hljs-operator">$</span>index_files<span class="hljs-operator">$</span>state<span class="hljs-punctuation">)</span><br>  res<span class="hljs-punctuation">[[</span>i<span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> bai<br>  cat<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;complete&quot;</span><span class="hljs-punctuation">,</span>i<span class="hljs-punctuation">,</span><span class="hljs-string">&quot;\n&quot;</span><span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">1</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">2</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">3</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">4</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">5</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">6</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">7</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">8</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">9</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">10</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">11</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">12</span> <br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> complete <span class="hljs-number">13</span><br>re <span class="hljs-operator">&lt;-</span> bind_rows<span class="hljs-punctuation">(</span>res<span class="hljs-punctuation">)</span><br>re<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>                                      id                                            filename                              md5<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>  a16a54a0<span class="hljs-operator">-</span>cd4a<span class="hljs-operator">-</span><span class="hljs-number">43</span>b7<span class="hljs-operator">-</span><span class="hljs-number">8272</span><span class="hljs-operator">-</span><span class="hljs-number">2565</span>b0930bda TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5KO<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">8</span>c6d16ebde6d101530ea3dcb7111fd9d<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>  <span class="hljs-number">327</span>a4450<span class="hljs-operator">-</span><span class="hljs-number">1</span>c36<span class="hljs-operator">-</span><span class="hljs-number">4677</span><span class="hljs-operator">-</span><span class="hljs-number">9288</span><span class="hljs-operator">-</span><span class="hljs-number">4</span>a54a7d0d842 TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LP<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">0214</span>ad9219ec0df5d324682b291427a7<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span>  <span class="hljs-number">4278</span>fd34<span class="hljs-operator">-</span><span class="hljs-number">4</span>f28<span class="hljs-operator">-</span><span class="hljs-number">4768</span><span class="hljs-operator">-</span>bb8e<span class="hljs-operator">-</span>c9388a702d39 TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5L2<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A30A<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">271381422</span>b85433078fc95b9f5018dbd<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span>  bf2a9bea<span class="hljs-operator">-</span>c1d6<span class="hljs-operator">-</span><span class="hljs-number">41</span>c4<span class="hljs-operator">-</span>a11c<span class="hljs-operator">-</span>acfb24916c4c TCGA<span class="hljs-operator">-</span>PK<span class="hljs-operator">-</span>A5HC<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A30A<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">70</span>c691fc38702fad1df7f10c97e0ce3c<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>  <span class="hljs-number">8047e7</span>a5<span class="hljs-operator">-</span><span class="hljs-number">4</span>eaf<span class="hljs-operator">-</span><span class="hljs-number">4518</span><span class="hljs-operator">-</span><span class="hljs-number">9</span>b8a<span class="hljs-operator">-</span><span class="hljs-number">76</span>c3c5bbd0c3 TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JR<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">332</span>d7af2eb8c669670f55ab688e27f45<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span>  <span class="hljs-number">8e4</span>e4082<span class="hljs-operator">-</span><span class="hljs-number">9856</span><span class="hljs-operator">-</span><span class="hljs-number">49</span>c8<span class="hljs-operator">-</span><span class="hljs-number">8</span>d69<span class="hljs-operator">-</span><span class="hljs-number">24</span>ac7351014a TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LS<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai be312d99dfcd1efe4a98814c0a1a48ed<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">7</span>  <span class="hljs-number">907e80</span>da<span class="hljs-operator">-</span>c646<span class="hljs-operator">-</span><span class="hljs-number">414</span>f<span class="hljs-operator">-</span><span class="hljs-number">8</span>d98<span class="hljs-operator">-</span>d5e3e7b4686f TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5KZ<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">574</span>fec9fed318557d84435b043d947bf<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>  <span class="hljs-number">29</span>daa003<span class="hljs-operator">-</span><span class="hljs-number">4169</span><span class="hljs-operator">-</span><span class="hljs-number">41</span>cf<span class="hljs-operator">-</span><span class="hljs-number">8452</span><span class="hljs-operator">-</span><span class="hljs-number">83</span>c06b6730e0 TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LA<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai c89f2e68dbf5bbf4cb1071ec7dbacfee<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">9</span>  <span class="hljs-number">7</span>f59ebcb<span class="hljs-operator">-</span>a57d<span class="hljs-operator">-</span><span class="hljs-number">458</span>d<span class="hljs-operator">-</span>ba7b<span class="hljs-operator">-</span><span class="hljs-number">9</span>b77abb1f3f7 TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LK<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">9330</span>ad033f2eabb6909d3e834d80d14e<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-number">00</span>fb3422<span class="hljs-operator">-</span><span class="hljs-number">6608</span><span class="hljs-operator">-</span><span class="hljs-number">44</span>ec<span class="hljs-operator">-</span><span class="hljs-number">9</span>afe<span class="hljs-operator">-</span><span class="hljs-number">39e7</span>bb0b52d4 TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5L5<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">67</span>feea2ef796f4dc872f3d344b59880e<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">11</span> c4595133<span class="hljs-operator">-</span><span class="hljs-number">679</span>a<span class="hljs-operator">-</span><span class="hljs-number">4967</span><span class="hljs-operator">-</span>beb3<span class="hljs-operator">-</span>df0d9867ffa6 TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JJ<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">303</span>acd0b62ac94d46ce8ca7b46b0b874<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">12</span> <span class="hljs-number">8</span>fab8841<span class="hljs-operator">-</span><span class="hljs-number">35</span>f4<span class="hljs-operator">-</span><span class="hljs-number">4</span>c1e<span class="hljs-operator">-</span>a3f2<span class="hljs-operator">-</span><span class="hljs-number">83</span>a8d3fb4ab6 TCGA<span class="hljs-operator">-</span>OU<span class="hljs-operator">-</span>A5PI<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">12</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai e39845ba41c2ebe18f9bf9639a6962af<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">13</span> <span class="hljs-number">950</span>a115d<span class="hljs-operator">-</span><span class="hljs-number">8102</span><span class="hljs-operator">-</span><span class="hljs-number">47</span>bc<span class="hljs-operator">-</span>aec2<span class="hljs-operator">-</span><span class="hljs-number">5</span>c3425a929fd TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JC<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.bai <span class="hljs-number">88</span>a3e25b655dcb9e3da954fd2b264192<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>       size    state<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>  <span class="hljs-number">6810304</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>  <span class="hljs-number">6797480</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span>  <span class="hljs-number">7075944</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span>  <span class="hljs-number">6882408</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>  <span class="hljs-number">6929096</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span>  <span class="hljs-number">6898896</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">7</span>  <span class="hljs-number">8387160</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>  <span class="hljs-number">6714080</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">9</span>  <span class="hljs-number">6785888</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-number">6834032</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">11</span> <span class="hljs-number">6675856</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">12</span> <span class="hljs-number">6776432</span> released<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">13</span> <span class="hljs-number">6707696</span> released<br><span class="hljs-comment"># write.table(re,file = &quot;~/data/TCGA_bai_manifest.txt&quot;,sep = &quot;\t&quot;,row.names = F,quote = F)</span><br></code></pre></td></tr></table></figure>

<p>然后基于 BAI 的 UUID 来下载 BAI 文件（这里还是使用了 gdc-client 来下载）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">../gdc-client download -m ../../TCGA_ACC_bai_manifest.txt -t ../gdc-user-token.2022-01-08T06_55_22.799Z.txt<br><br><span class="hljs-built_in">ls</span> &gt; files<br><span class="hljs-built_in">mkdir</span> BAI<br><span class="hljs-built_in">cat</span> files | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> i;<span class="hljs-keyword">do</span> <span class="hljs-built_in">cp</span> ./<span class="hljs-variable">$i</span>/*.bai ./BAI/;<span class="hljs-keyword">done</span><br><span class="hljs-built_in">ls</span> BAI/<br><span class="hljs-comment">#TCGA-OR-A5JC-01A-11D-A29I-10_Illumina_gdc_realn.bai  TCGA-OR-A5LA-01A-11D-A29I-10_Illumina_gdc_realn.bai</span><br><span class="hljs-comment">#TCGA-OR-A5JJ-01A-11D-A29I-10_Illumina_gdc_realn.bai  TCGA-OR-A5LK-01A-11D-A29I-10_Illumina_gdc_realn.bai</span><br><span class="hljs-comment">#TCGA-OR-A5JR-01A-11D-A29I-10_Illumina_gdc_realn.bai  TCGA-OR-A5LP-01A-11D-A29I-10_Illumina_gdc_realn.bai</span><br><span class="hljs-comment">#TCGA-OR-A5KO-01A-11D-A29I-10_Illumina_gdc_realn.bai  TCGA-OR-A5LS-01A-11D-A29I-10_Illumina_gdc_realn.bai</span><br><span class="hljs-comment">#TCGA-OR-A5KZ-01A-11D-A29I-10_Illumina_gdc_realn.bai  TCGA-OU-A5PI-01A-12D-A29I-10_Illumina_gdc_realn.bai</span><br><span class="hljs-comment">#TCGA-OR-A5L2-01A-11D-A30A-10_Illumina_gdc_realn.bai  TCGA-PK-A5HC-01A-11D-A30A-10_Illumina_gdc_realn.bai</span><br><span class="hljs-comment">#TCGA-OR-A5L5-01A-11D-A29I-10_Illumina_gdc_realn.bai</span><br></code></pre></td></tr></table></figure>

<p>再利用 <code>samtools</code> 的 idxstats 功能统计 reads（这里随便拿一个 BAM 文件就行）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> *.bai &gt; bai_files<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">cat</span> bai_files | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> i<br><span class="hljs-keyword">do</span><br>  newname=`<span class="hljs-built_in">basename</span> <span class="hljs-variable">$i</span> .bai`<br>  <span class="hljs-built_in">mv</span> ../BAI/dummy.bam ../BAI/<span class="hljs-variable">$newname</span>.bam<br>  samtools idxstats ../BAI/<span class="hljs-variable">$newname</span>.bam &gt; ./stat_files/<span class="hljs-variable">$newname</span>.txt<br>  <span class="hljs-built_in">mv</span> ../BAI/<span class="hljs-variable">$newname</span>.bam ../BAI/dummy.bam<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">head</span> ~/data/TCGA_bai/test/stat_files/TCGA-OR-A5JC-01A-11D-A29I-10_Illumina_gdc_realn.txt<br>&gt;&gt; chr1 248956422   8655782 9484<br>&gt;&gt; chr10    133797422   6282801 6836<br>&gt;&gt; chr11    135086622   4863250 5439<br>&gt;&gt; chr11_KI270721v1_random  100316  3985679 4321<br>&gt;&gt; chr12    133275309   7341751 8237<br>&gt;&gt; chr13    114364328   5048809 5472<br>&gt;&gt; chr14    107043718   4231568 4745<br>&gt;&gt; chr14_GL000009v2_random  201709  3673268 4058<br>&gt;&gt; chr14_GL000225v1_random  211173  3236746 3564<br>&gt;&gt; chr14_KI270722v1_random  194050  4261146 4737<br></code></pre></td></tr></table></figure>

<p>得到的文件的第三列就是各个染色体 mapped 的总 reads，然后就可以利用上面的公式进行计算测序深度了：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs r">files <span class="hljs-operator">&lt;-</span> list.files<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;~/data/TCGA_bai/test/stat_files/&quot;</span><span class="hljs-punctuation">)</span><br>dt <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>file<span class="hljs-operator">=</span>files<span class="hljs-punctuation">)</span><br>dt<span class="hljs-operator">$</span>samples <span class="hljs-operator">&lt;-</span> gsub<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;.+[.]TCGA&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;TCGA&quot;</span><span class="hljs-punctuation">,</span>files<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  gsub<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;[.][0-9].+[_gdc_realn.txt]&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span>.<span class="hljs-punctuation">)</span> <span class="hljs-operator">%&gt;%</span> <br>  substr<span class="hljs-punctuation">(</span>.<span class="hljs-punctuation">,</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">16</span><span class="hljs-punctuation">)</span><br>dt<span class="hljs-operator">$</span>depth <span class="hljs-operator">&lt;-</span> <span class="hljs-literal">NA</span><br><span class="hljs-keyword">for</span> <span class="hljs-punctuation">(</span>i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span>nrow<span class="hljs-punctuation">(</span>dt<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span><br>  a <span class="hljs-operator">&lt;-</span> data.table<span class="hljs-operator">::</span>fread<span class="hljs-punctuation">(</span>paste0<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;~/data/TCGA_bai/test/stat_files/&quot;</span><span class="hljs-punctuation">,</span>dt<span class="hljs-operator">$</span>file<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span>data.table <span class="hljs-operator">=</span> <span class="hljs-built_in">F</span><span class="hljs-punctuation">)</span><br>  depth <span class="hljs-operator">&lt;-</span> <span class="hljs-punctuation">(</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">sum</span><span class="hljs-punctuation">(</span>a<span class="hljs-operator">$</span>V3<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-operator">/</span><span class="hljs-punctuation">(</span><span class="hljs-number">38000000</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">*</span> <span class="hljs-number">101</span><br>  dt<span class="hljs-operator">$</span>depth<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> depth<br><span class="hljs-punctuation">&#125;</span><br>dt<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span>                                                   file          samples    depth<br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JC<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JC<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">253.7207</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JJ<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JJ<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">242.3565</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JR<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5JR<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">290.4985</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">4</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5KO<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5KO<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">304.1783</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5KZ<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5KZ<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">463.0472</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">6</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5L2<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A30A<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5L2<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">301.6314</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">7</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5L5<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5L5<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">283.6341</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LA<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LA<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">195.8037</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">9</span>  TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LK<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LK<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">267.7285</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LP<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LP<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">272.8540</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">11</span> TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LS<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OR<span class="hljs-operator">-</span>A5LS<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">313.4699</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">12</span> TCGA<span class="hljs-operator">-</span>OU<span class="hljs-operator">-</span>A5PI<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">12</span>D<span class="hljs-operator">-</span>A29I<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>OU<span class="hljs-operator">-</span>A5PI<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">260.9008</span><br><span class="hljs-operator">&gt;</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">13</span> TCGA<span class="hljs-operator">-</span>PK<span class="hljs-operator">-</span>A5HC<span class="hljs-operator">-</span><span class="hljs-number">01</span>A<span class="hljs-operator">-</span><span class="hljs-number">11</span>D<span class="hljs-operator">-</span>A30A<span class="hljs-operator">-</span><span class="hljs-number">10</span>_Illumina_gdc_realn.txt TCGA<span class="hljs-operator">-</span>PK<span class="hljs-operator">-</span>A5HC<span class="hljs-operator">-</span><span class="hljs-number">01</span>A <span class="hljs-number">329.6680</span><br></code></pre></td></tr></table></figure>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/" class="category-chain-item">生物信息</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>使用R包GenomicDataCommons下载和处理TCGA数据</div>
      <div>http://example.com/2022/01/07/GenomicDataCommons/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>wutao</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年1月7日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/01/24/star_fusion/" title="使用 STAR-Fusion 鉴别融合基因">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">使用 STAR-Fusion 鉴别融合基因</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/12/15/GAN/" title="对抗生成网络">
                        <span class="hidden-mobile">对抗生成网络</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://cdn.jsdelivr.net/npm/@waline/client@0.14.8/dist/waline.min.css')
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@waline/client@0.14.8/dist/waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://comments-flax.vercel.app","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  
    
  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        MathJax = {
          tex    : {
            inlineMath: { '[+]': [['$', '$']] }
          },
          loader : {
            
          },
          options: {
            renderActions: {
              findScript    : [10, doc => {
                document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                  const display = !!node.type.match(/; *mode=display/);
                  const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                  const text = document.createTextNode('');
                  node.parentNode.replaceChild(text, node);
                  math.start = { node: text, delim: '', n: 0 };
                  math.end = { node: text, delim: '', n: 0 };
                  doc.math.push(math);
                });
              }, '', false],
              insertedScript: [200, () => {
                document.querySelectorAll('mjx-container').forEach(node => {
                  let target = node.parentNode;
                  if (target.nodeName.toLowerCase() === 'li') {
                    target.parentNode.classList.add('has-jax');
                  }
                });
              }, '', false]
            }
          }
        };
      </script>
    

  <script  src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
